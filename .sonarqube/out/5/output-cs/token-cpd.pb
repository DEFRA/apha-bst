µ
;D:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
if 
( 
builder 
. 
Environment 
. 
IsEnvironment %
(% &
$str& -
)- .
). /
{ 
builder		 
.		 
Host		 
.		 

UseSerilog		 
(		 
(		 
ctx		  
,		  !
lc		" $
)		$ %
=>		& (
{

 
lc 

.
 
WriteTo 
. 
Console 
( 
) 
; 
string 
srvpath 
= 
ctx 
. 
Configuration *
.* +
GetValue+ 3
<3 4
string4 :
>: ;
(; <
$str< F
)F G
??H J
stringK Q
.Q R
EmptyR W
;W X
string 
logpath 
= 
$" 
{ 
srvpath #
}# $
$str$ 3
"3 4
;4 5
lc 

.
 
WriteTo 
. 
File 
( 
logpath 
,  
Serilog! (
.( )
Events) /
./ 0
LogEventLevel0 =
.= >
Error> C
,C D
rollingIntervalE T
:T U
RollingIntervalV e
.e f
Dayf i
)i j
;j k
} 
) 
; 
} 
else 
{ 
Serilog 
. 
	Debugging 
. 
SelfLog 
. 
Enable $
($ %
Console% ,
., -
Error- 2
)2 3
;3 4
builder 
. 
Host 
. 

UseSerilog 
( 
( 
context $
,$ %
services& .
,. /
loggerConfiguration0 C
)C D
=>E G
{ 
loggerConfiguration 
. 
UseAwsCloudWatch ,
(, -
builder- 4
.4 5
Configuration5 B
)B C
;C D
} 
) 
; 
} 
builder 
. 
ConfigureServices 
( 
) 
; 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
app 
. 
ConfigureMiddleware 
( 
) 
; 
await77 
app77 	
.77	 

RunAsync77
 
(77 
)77 
;77 
public:: 
partial:: 
class:: 
Program:: 
{;; 
	protected== 
Program== 
(== 
)== 
{== 
}== 
}>> í
WD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\PresentationService\UserDataService.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
PresentationService *
{ 
public 

class 
UserDataService  
:  !
IUserDataService! 1
{ 
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
;B C
private 
readonly 
IDataEntryService *
_dataEntryService+ <
;< =
public

 
UserDataService

 
(

  
IHttpContextAccessor

 3
httpContextAccessor

4 G
,

G H
IDataEntryService

I Z
dataEntryService

[ k
)

k l
{ 	 
_httpContextAccessor  
=! "
httpContextAccessor# 6
;6 7
_dataEntryService 
= 
dataEntryService  0
;0 1
} 	
public 
string 
? 
GetUsername "
(" #
)# $
{ 	
return  
_httpContextAccessor '
.' (
HttpContext( 3
?3 4
.4 5
User5 9
?9 :
.: ;
Identity; C
?C D
.D E
NameE I
;I J
} 	
public 
async 
Task 
< 
bool 
> 
CanEditPage  +
(+ ,
string, 2
action3 9
)9 :
{ 	
var 
role 
=  
_httpContextAccessor +
.+ ,
HttpContext, 7
?7 8
.8 9
User9 =
?= >
.> ?
Claims? E
?E F
.F G
FirstOrDefaultG U
(U V
cV W
=>X Z
c
 
. 
Type 
== 
$str 
) 
? 
. 
Value $
;$ %
if 
( 
string 
. 
IsNullOrEmpty $
($ %
role% )
)) *
)* +
{ 
return 
false 
; 
} 
else 
if 
( 
role 
== 
$str  
)  !
return 
true 
; 
else 
if 
( 
role 
== 
$str  
)  !
{   
return!! 
await!! 
_dataEntryService!! .
.!!. /
CanEditPage!!/ :
(!!: ;
action!!; A
)!!A B
;!!B C
}"" 
else## 
if## 
(## 
role## 
==## 
$str##  
)##  !
return$$ 
false$$ 
;$$ 
else%% 
return&& 
false&& 
;&& 
}(( 	
})) 
}** Ë
RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\PresentationService\LogService.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
PresentationService *
{ 
public 

class 

LogService 
: 
ILogService )
{ 
private 
readonly 
ILogger  
<  !

LogService! +
>+ ,
_logger- 4
;4 5
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 

LogService 
( 
ILogger !
<! "

LogService" ,
>, -
logger. 4
,4 5
IConfiguration6 D
configurationE R
)R S
{		 	
_logger

 
=

 
logger

 
;

 
_configuration 
= 
configuration *
;* +
} 	
public 
void 
LogGeneralException '
(' (
	Exception( 1
ex2 4
,4 5
string6 <
context= D
)D E
{ 	
string 
generalErrorType #
=$ %
_configuration& 4
[4 5
$str5 M
]M N
??O Q
$strR n
;n o
_logger 
. 
LogError 
( 
ex 
,  
$str! T
,T U
generalErrorTypeV f
,f g
contexth o
,o p
exq s
.s t
Messaget {
){ |
;| }
} 	
public 
void 
LogSqlException #
(# $
	Exception$ -
ex. 0
,0 1
string2 8
context9 @
)@ A
{ 	
string 
sqlErrorType 
=  !
_configuration" 0
[0 1
$str1 E
]E F
??G I
$strJ f
;f g
_logger 
. 
LogError 
( 
ex 
,  
$str! T
,T U
sqlErrorTypeV b
,b c
contextc j
,j k
exl n
.n o
Messageo v
)v w
;w x
} 	
} 
} ‹
XD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\PresentationService\IUserDataService.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
PresentationService *
{ 
public 

	interface 
IUserDataService %
{ 
string 
? 
GetUsername 
( 
) 
; 
Task 
< 
bool 
> 
CanEditPage 
( 
string %
action& ,
), -
;- .
} 
} â
SD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\PresentationService\ILogService.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
PresentationService *
{ 
public 

	interface 
ILogService  
{ 
void 
LogGeneralException  
(  !
	Exception! *
ex+ -
,- .
string/ 5
context6 =
)= >
;> ?
void 
LogSqlException 
( 
	Exception &
ex' )
,) *
string+ 1
context2 9
)9 :
;: ;
} 
} ±

LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\ViewUserViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
ViewUserViewModel "
:" #
BaseViewModel# 0
{ 
public 
string 
SelectedUserId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
$str5 7
;7 8
public		 
IEnumerable		 
<		 
SelectListItem		 )
>		) *
Users		+ 0
{		1 2
get		3 6
;		6 7
set		8 ;
;		; <
}		= >
=		? @
new		A D
List		E I
<		I J
SelectListItem		J X
>		X Y
(		Y Z
)		Z [
;		[ \
public

 
IEnumerable

 
<

 
UserViewDto

 &
>

& '
UserList

( 0
{

1 2
get

3 6
;

6 7
set

8 ;
;

; <
}

= >
=

? @
new

A D
List

E I
<

I J
UserViewDto

J U
>

U V
(

V W
)

W X
;

X Y
} 
} ‰
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\ViewNewsViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
ViewNewsViewModel "
:# $
BaseViewModel% 2
{ 
public 
List 
< 
NewsDto 
> 
NewsList %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
new6 9
List: >
<> ?
NewsDto? F
>F G
(G H
)H I
;I J
public 
string 
? 
Message 
{  
get! $
;$ %
set& )
;) *
}+ ,
}		 
}

 ß
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TrainingViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
TrainingViewModel "
{ 
public 
int 
PersonID 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Person 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
? 
TrainingAnimal %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public		 
DateTime		 
TrainingDateTime		 (
{		) *
get		+ .
;		. /
set		0 3
;		3 4
}		5 6
public

 
string

 
?

 
TrainingType

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
int 
	TraineeId 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ±	
PD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TrainingListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class !
TrainingListViewModel &
:' (
BaseViewModel) 6
{ 
public 
List 
< 
SelectListItem "
>" #
?# $
AllTrainees% 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
=? @
newA D
ListE I
<I J
SelectListItemJ X
>X Y
(Y Z
)Z [
;[ \
public		 
IEnumerable		 
<		 
TrainingViewModel		 ,
>		, -
?		- .
FilteredTrainings		/ @
{		A B
get		C F
;		F G
set		H K
;		K L
}		M N
public

 
string

 
?

 
SelectedTraineeId

 (
{

) *
get

+ .
;

. /
set

0 3
;

3 4
}

5 6
} 
} à
OD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TrainingHistoryModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class  
TrainingHistoryModel %
{ 
public 
int 
PersonID 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Person 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
? 
Role 
{ 
get !
;! "
set# &
;& '
}( )
public 
int 
	TrainerID 
{ 
get "
;" #
set$ '
;' (
}) *
public		 
string		 
?		 
TrainingAnimal		 %
{		& '
get		( +
;		+ ,
set		- 0
;		0 1
}		2 3
public

 
DateTime

 
TrainingDateTime

 (
{

) *
get

+ .
;

. /
set

0 3
;

3 4
}

5 6
public 
string 
? 
Trainer 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ·

RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TrainerTrainedViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class #
TrainerTrainedViewModel (
:( )
BaseViewModel) 6
{ 
public 
int 
SelectedTrainerId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public

 
List

 
<

 
TrainerTrainedModel

 '
>

' (
?

( )
AllTrainers

* 5
{

6 7
get

8 ;
;

; <
set

= @
;

@ A
}

B C
public 
List 
< 
SelectListItem "
>" #
TrainerSelectList$ 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
=D E
newF I
(I J
)J K
;K L
public 
List 
< 
TrainerTrainedDto %
>% &
?& '"
TraineeTrainingDetails( >
{? @
getA D
;D E
setF I
;I J
}K L
} 
} ž
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TrainerTrainedModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
TrainerTrainedModel $
{ 
public 
int 
	TraineeNo 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
Trainee 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
? 
Site 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
SpeciesTrained %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public		 
DateTime		 
DateTrained		 #
{		$ %
get		& )
;		) *
set		+ .
;		. /
}		0 1
public

 
int

 
PersonID

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
Person 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
} 
} Ý
RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TrainerHistoryViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class #
TrainerHistoryViewModel (
:( )
BaseViewModel) 6
{ 
public 
int 
SelectedTrainerId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public		 
string		 
?		 
SelectedSpecies		 &
{		' (
get		) ,
;		, -
set		. 1
;		1 2
}		3 4
public

 
List

 
<

 #
TraineeTrainerViewModel

 +
>

+ ,
?

, -
AllTrainers

. 9
{

: ;
get

< ?
;

? @
set

A D
;

D E
}

F G
public 
List 
< 
SelectListItem "
>" #
AllTrainersList$ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
=B C
newD G
ListH L
<L M
SelectListItemM [
>[ \
(\ ]
)] ^
;^ _
public 
List 
<  
TrainingHistoryModel (
>( )
?) *
HistoryDetails+ 9
{: ;
get< ?
;? @
setA D
;D E
}F G
public 
List 
< 
SelectListItem "
>" #
TrainingAnimalList$ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
=E F
newG J
(J K
)K L
;L M
} 
} ¤
RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\TraineeTrainerViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class #
TraineeTrainerViewModel (
{ 
public 
int 
PersonID 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Person 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ‚
HD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\SiteViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
SiteViewModel 
: 
BaseViewModel ,
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ?
)? @
]@ A
public 
string 
PlantNo 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
null. 2
!2 3
;3 4
[

 	
Required

	 
(

 
ErrorMessage

 
=

  
$str

! 9
)

9 :
]

: ;
public 
required 
string 
Name #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
AddressLine1 #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
AddressLine2 #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
AddressTown "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
? 
AddressCounty $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
? 
AddressPostCode &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
? 
	Telephone  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
? 
Fax 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
? 
Ahvla 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ž
OD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\SiteTraineeViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class  
SiteTraineeViewModel %
{ 
public 
int 
PersonId 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
Person 
{ 
get  #
;# $
set% (
;( )
}* +
}		 
}

 â

SD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\SiteTraineeListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class $
SiteTraineeListViewModel )
:) *
BaseViewModel* 7
{ 
public 
IEnumerable 
< 
SelectListItem )
>) *
?* +
AllSites, 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
SelectListItemN \
>\ ]
(] ^
)^ _
;_ `
public		 
IEnumerable		 
<		  
SiteTraineeViewModel		 /
>		/ 0
?		0 1
FilteredTrainees		2 B
{		C D
get		E H
;		H I
set		J M
;		M N
}		O P
public

 
string

 
?

 
SelectedSite

 #
{

$ %
get

& )
;

) *
set

+ .
;

. /
}

0 1
public 
string 
? 
Message 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ²	
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\SiteListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
SiteListViewModel "
:" #
BaseViewModel# 0
{ 
public 
IEnumerable 
< 
SelectListItem )
>) *
AllSites+ 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
=B C
newD G
ListH L
<L M
SelectListItemM [
>[ \
(\ ]
)] ^
;^ _
public 
IEnumerable 
< 
SiteViewModel (
>( )
?) *
FilteredSites+ 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
public		 
string		 
SelectedSite		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
=		1 2
$str		3 8
;		8 9
}

 
} ú
JD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\ReportViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
ReportViewModel  
:! "
BaseViewModel# 0
{ 
public 
string 
ReportTitle !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
$str2 ;
;; <
public 
string 
? 
ErrorMessage #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} Ì
JD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\PersonViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
PersonViewModel  
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 1
)1 2
]2 3
public 
int 
PersonId 
{ 
get !
;! "
set# &
;& '
}( )
public		 
string		 
?		 
Person		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 
string

 
?

 

LocationId

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
int 
? 
VlalocationId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
PlantNo 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Ä

ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\PersonListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
PersonListViewModel $
:$ %
BaseViewModel% 2
{ 
public 
IEnumerable 
< 
SelectListItem )
>) *
	AllPerson+ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
SelectListItemN \
>\ ]
(] ^
)^ _
;_ `
public

 
IEnumerable

 
<

 
PersonViewModel

 *
>

* +
FilteredPerson

, :
{

; <
get

= @
;

@ A
set

B E
;

E F
}

G H
=

I J
new

K N
List

O S
<

S T
PersonViewModel

T c
>

c d
(

d e
)

e f
;

f g
public 
int 
SelectedPerson !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
$num2 3
;3 4
} 
} ü
JD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\PaginationModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
PaginationModel  
{ 
public 
int 

TotalCount 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. /
;/ 0
public 
int 

PageNumber 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. /
;/ 0
public 
int 
PageSize 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$num, .
;. /
public 
string 
? 

SortColumn !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
bool		 
SortDirection		 !
{		" #
get		$ '
;		' (
set		) ,
;		, -
}		. /
=		0 1
false		2 7
;		7 8
public

 
int

 

TotalPages

 
=>

  
(

! "
int

" %
)

% &
Math

& *
.

* +
Ceiling

+ 2
(

2 3
(

3 4
double

4 :
)

: ;

TotalCount

; E
/

F G
PageSize

H P
)

P Q
;

Q R
} 
} ‡
KD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\OldNewsViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
OldNewsViewModel !
:" #
BaseViewModel$ 1
{ 
public 
List 
< 
NewsDto 
> 
NewsList %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
new6 9
List: >
<> ?
NewsDto? F
>F G
(G H
)H I
;I J
public 
string 
? 
Message 
{  
get! $
;$ %
set& )
;) *
}+ ,
}		 
}

 ð
HD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\NewsViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
NewsViewModel 
{ 
public 
string 
? 
Title 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
NewsContent "
{# $
get% (
;( )
set* -
;- .
}/ 0
public		 
DateTime		 
DatePublished		 %
{		& '
get		( +
;		+ ,
set		- 0
;		0 1
}		2 3
public 
string 
? 
Author 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} Û
HD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\HelpViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
HelpViewModel 
{ 
public 
required 
List 
< 
HelpListViewModel .
>. /
Sections0 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
public 
int 
ActiveViewIndex "
{# $
get& )
;) *
set+ .
;. /
}0 1
}		 
}

 ˆ
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\HelpListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
HelpListViewModel "
{ 
public 
string 
? 
Title 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
ImageUrl 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
? 
AdditionalInfo %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
}		 
}

 Þ
ID:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\ErrorViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 ø
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\EditUserViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
EditUserViewModel "
:" #
BaseViewModel# 0
{ 
public 
string 
UserId 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
[

 	
Required

	 
(

 
ErrorMessage

 
=

  
$str

! 8
)

8 9
]

9 :
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
( 
ErrorMessage 
=  
$str! A
)A B
]B C
public 
string 
UserLoc 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
, 
ErrorMessage  ,
=- .
$str/ G
)G H
]H I
public 
byte 
	UserLevel 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. /
;/ 0
public 
IEnumerable 
< 
SelectListItem )
>) *
	Locations+ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
SelectListItemN \
>\ ]
(] ^
)^ _
;_ `
public 
IEnumerable 
< 
SelectListItem )
>) *

UserLevels+ 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
=D E
newF I
ListJ N
<N O
SelectListItemO ]
>] ^
(^ _
)_ `
;` a
} 
} œ!
PD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\EditTrainingViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class !
EditTrainingViewModel &
:& '
BaseViewModel' 4
{ 
[ 	
Required	 
] 
public		 
required		 
int		 
	TraineeId		 %
{		& '
get		( +
;		+ ,
set		- 0
;		0 1
}		2 3
[ 	
Required	 
] 
public 
required 
int 
	TrainerId %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Required	 
] 
public 
required 
string 
TrainingType +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
[ 	
Required	 
] 
public 
required 
string 
TrainingAnimal -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
[ 	
Required	 
] 
public 
required 
DateTime  
TrainingDateTime! 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
public 
IEnumerable 
< 
SelectListItem )
>) *
TraineeList+ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
=E F
newG J
ListK O
<O P
SelectListItemP ^
>^ _
(_ `
)` a
;a b
public 
IEnumerable 
< 
SelectListItem )
>) *
TrainerList+ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
=E F
newG J
ListK O
<O P
SelectListItemP ^
>^ _
(_ `
)` a
;a b
public 
IEnumerable 
< 
SelectListItem )
>) *
TrainingTypesList+ <
{= >
get? B
;B C
setD G
;G H
}I J
=K L
newM P
ListQ U
<U V
SelectListItemV d
>d e
(e f
)f g
;g h
public 
IEnumerable 
< 
SelectListItem )
>) *
TrainingAnimalList+ =
{> ?
get@ C
;C D
setE H
;H I
}J K
=L M
newN Q
ListR V
<V W
SelectListItemW e
>e f
(f g
)g h
;h i
[ 	
Required	 
] 
public 
required 
DateTime  
TrainingDateTimeOld! 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
[   	
Required  	 
]   
public!! 
required!! 
int!! 
TraineeIdOld!! (
{!!) *
get!!+ .
;!!. /
set!!0 3
;!!3 4
}!!5 6
["" 	
Required""	 
]"" 
public## 
required## 
int## 
TrainerIdOld## (
{##) *
get##+ .
;##. /
set##0 3
;##3 4
}##5 6
[$$ 	
Required$$	 
]$$ 
public%% 
required%% 
string%% 
TrainingAnimalOld%% 0
{%%1 2
get%%3 6
;%%6 7
set%%8 ;
;%%; <
}%%= >
[&& 	
Required&&	 
]&& 
public'' 
required'' 
string'' 
TrainingTypeOld'' .
{''/ 0
get''1 4
;''4 5
set''6 9
;''9 :
}''; <
}(( 
}** •
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\EditSiteViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
EditSiteViewModel "
:" #
BaseViewModel# 0
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ?
)? @
]@ A
public 
string 
PlantNo 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
null. 2
!2 3
;3 4
[

 	
Required

	 
(

 
ErrorMessage

 
=

  
$str

! 9
)

9 :
]

: ;
public 
required 
string 
Name #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
AddressLine1 #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
AddressLine2 #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
AddressTown "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
? 
AddressCounty $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
string 
? 
AddressPostCode &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
? 
	Telephone  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
? 
Fax 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Display	 
( 
Name 
= 
$str $
)$ %
]% &
public 
required 
bool 
IsAhvla $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} ·
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\EditPersonViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
EditPersonViewModel $
:$ %
BaseViewModel% 2
{ 
public

 
string

 
?

 
Name

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
required 
int 
PersonId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ;
); <
]< =
public 
string 
Person 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
null- 1
!1 2
;2 3
public 
IEnumerable 
< 
SelectListItem )
>) *
SiteOptions+ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
=E F
newG J
ListK O
<O P
SelectListItemP ^
>^ _
(_ `
)` a
;a b
} 
} ˜
HD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\BaseViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
BaseViewModel 
{ 
public 
bool 
CanEdit 
{ 
get !
;! "
set# &
;& '
}( )
=* +
false, 1
;1 2
} 
} ±	
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AuditLogViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
AuditLogViewModel "
{ 
public 
string 
? 
	Procedure  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
? 

Parameters !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
string		 
?		 
User		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public 
DateTime 
? 
Date 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
? 
TransactionType &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} Ã	
UD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AuditLogsArchivedViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class &
AuditLogsArchivedViewModel +
{ 
public 
string 
? 
	Procedure  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
? 

Parameters !
{" #
get$ '
;' (
set) ,
;, -
}. /
public		 
string		 
?		 
User		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
public 
DateTime 
? 
Date 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
? 
TransactionType &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ©
PD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AuditLogListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class !
AuditLogListViewModel &
{ 
public 
IEnumerable 
< 
SelectListItem )
>) *
StoredProcedures+ ;
{< =
get> A
;A B
setC F
;F G
}H I
=J K
newL O
ListP T
<T U
SelectListItemU c
>c d
(d e
)e f
;f g
public		 
List		 
<		 
AuditLogViewModel		 %
>		% &
?		& '
AuditLogsResults		( 8
{		9 :
get		; >
;		> ?
set		@ C
;		C D
}		E F
public

 
PaginationModel

 
?

 

Pagination

  *
{

+ ,
get

- 0
;

0 1
set

2 5
;

5 6
}

7 8
public 
string 
StoredProcedure %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
$str6 9
;9 :
public 
bool 
SortOrderFor  
(  !
string! '
column( .
). /
{ 	
if 
( 

Pagination 
!= 
null "
)" #
return 
! 
( 

Pagination #
.# $

SortColumn$ .
==/ 1
column2 8
&&9 ;

Pagination< F
.F G
SortDirectionG T
)T U
;U V
else 
return 
true 
; 
} 	
} 
} Â
XD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AuditLogArchivedListViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class )
AuditLogArchivedListViewModel .
{ 
public 
IEnumerable 
< 
SelectListItem )
>) *
StoredProcedures+ ;
{< =
get> A
;A B
setC F
;F G
}H I
=J K
newL O
ListP T
<T U
SelectListItemU c
>c d
(d e
)e f
;f g
public 
List 
< &
AuditLogsArchivedViewModel .
>. /
?/ 0
AuditLogsResults1 A
{B C
getD G
;G H
setI L
;L M
}N O
public		 
PaginationModel		 
?		 

Pagination		  *
{		+ ,
get		- 0
;		0 1
set		2 5
;		5 6
}		7 8
public

 
string

 
StoredProcedure

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
=

4 5
$str

6 9
;

9 :
public 
bool 
SortOrderFor  
(  !
string! '
column( .
). /
{ 	
if 
( 

Pagination 
!= 
null "
)" #
return 
! 
( 

Pagination #
.# $

SortColumn$ .
==/ 1
column2 8
&&9 ;

Pagination< F
.F G
SortDirectionG T
)T U
;U V
else 
return 
true 
; 
} 	
} 
} ä
KD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AddUserViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
AddUserViewModel !
:! "
BaseViewModel" /
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! <
)< =
]= >
[		 	
EmailAddress			 
(		 
ErrorMessage		 "
=		# $
$str		% I
)		I J
]		J K
public

 
string

 
?

 
UserId

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 8
)8 9
]9 :
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
, 
ErrorMessage  ,
=- .
$str/ G
)G H
]H I
public 
byte 
	UserLevel 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
$num. /
;/ 0
[ 	
Required	 
( 
ErrorMessage 
=  
$str! A
)A B
]B C
public 
string 
UserLoc 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
public 
IEnumerable 
< 
SelectListItem )
>) *

UserLevels+ 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
=D E
newF I
ListJ N
<N O
SelectListItemO ]
>] ^
(^ _
)_ `
;` a
public 
IEnumerable 
< 
SelectListItem )
>) *
	Locations+ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
=C D
newE H
ListI M
<M N
SelectListItemN \
>\ ]
(] ^
)^ _
;_ `
} 
} £
OD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AddTrainingViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class  
AddTrainingViewModel %
:% &
BaseViewModel& 3
{ 
[		 	
Range			 
(		 
$num		 
,		 
int		 
.		 
MaxValue		 
,		 
ErrorMessage		  ,
=		- .
$str		/ D
)		D E
]		E F
public

 
int

 
PersonId

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
, 
ErrorMessage  ,
=- .
$str/ D
)D E
]E F
public 
int 
	TrainerId 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ;
); <
]< =
public 
string 
TrainingType "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
null3 7
!7 8
;8 9
[ 	
Required	 
( 
ErrorMessage 
=  
$str! =
)= >
]> ?
public 
string 
TrainingAnimal $
{% &
get' *
;* +
set, /
;/ 0
}1 2
=3 4
null5 9
!9 :
;: ;
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ?
)? @
]@ A
public 
DateTime 
? 
TrainingDateTime )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
IEnumerable 
< 
SelectListItem )
>) *
Persons+ 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
=A B
newC F
ListG K
<K L
SelectListItemL Z
>Z [
([ \
)\ ]
;] ^
public 
IEnumerable 
< 
SelectListItem )
>) *
TrainingTypesList+ <
{= >
get? B
;B C
setD G
;G H
}I J
=K L
newM P
ListQ U
<U V
SelectListItemV d
>d e
(e f
)f g
;g h
public 
IEnumerable 
< 
SelectListItem )
>) *
TrainingAnimalList+ =
{> ?
get@ C
;C D
setE H
;H I
}J K
=L M
newN Q
ListR V
<V W
SelectListItemW e
>e f
(f g
)g h
;h i
} 
} ë
MD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AddPersonViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
AddPersonViewModel #
:# $
BaseViewModel$ 1
{ 
[		 	
Required			 
(		 
ErrorMessage		 
=		  
$str		! =
)		= >
]		> ?
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
=

) *
null

+ /
!

/ 0
;

0 1
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ?
)? @
]@ A
public 
string 
PlantNo 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
null. 2
!2 3
;3 4
public 
string 
? 

LocationId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
IEnumerable 
< 
SelectListItem )
>) *
Sites+ 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
=? @
newA D
ListE I
<I J
SelectListItemJ X
>X Y
(Y Z
)Z [
;[ \
} 
} Å
KD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Models\AddNewsViewModel.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Models 
{ 
public 

class 
AddNewsViewModel !
:! "
BaseViewModel" /
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 6
)6 7
]7 8
public		 
string		 
Title		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
=		* +
string		, 2
.		2 3
Empty		3 8
;		8 9
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 8
)8 9
]9 :
public 
string 
NewsContent !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
string2 8
.8 9
Empty9 >
;> ?
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 9
)9 :
]: ;
[ 	
Display	 
( 
Name 
= 
$str ,
), -
]- .
public 
DateTime 
DatePublished %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
DateTime6 >
.> ?
Now? B
;B C
[ 	
Display	 
( 
Name 
= 
$str 3
)3 4
]4 5
public 
bool 
UseCurrentDateTime &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
=5 6
false7 <
;< =
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 5
)5 6
]6 7
public 
string 
Author 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
string- 3
.3 4
Empty4 9
;9 :
public 
IEnumerable 
< 
SelectListItem )
>) *
Users+ 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
=? @
newA D
ListE I
<I J
SelectListItemJ X
>X Y
(Y Z
)Z [
;[ \
} 
} ß
RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Middleware\ExceptionMiddleware.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 

Middleware !
{ 
public 

class 
ExceptionMiddleware $
{ 
private 
readonly 
RequestDelegate (
_next) .
;. /
private 
readonly 
ILogger  
<  !
ExceptionMiddleware! 4
>4 5
_logger6 =
;= >
private		 
readonly		 
IConfiguration		 '
_configuration		( 6
;		6 7
public 
ExceptionMiddleware "
(" #
RequestDelegate# 2
next3 7
,7 8
ILogger9 @
<@ A
ExceptionMiddlewareA T
>T U
loggerV \
,\ ]
IConfiguration^ l
configurationm z
)z {
{ 	
_next 
= 
next 
; 
_logger 
= 
logger 
; 
_configuration 
= 
configuration *
;* +
} 	
public 
async 
Task 
InvokeAsync %
(% &
HttpContext& 1
context2 9
)9 :
{ 	
try 
{ 
await 
_next 
( 
context #
)# $
;$ %
} 
catch 
( 
	Exception 
ex 
)  
{ 
string 
	errorCode  
;  !
string 
	ErrorType  
=! "
_configuration# 1
[1 2
$str2 J
]J K
??L N
$strO k
;k l
if 
( 
ex 
is '
UnauthorizedAccessException 5
)5 6
{ 
	errorCode   
=   
$str    1
;  1 2
_logger!! 
.!! 
LogError!! $
(!!$ %
ex!!% '
,!!' (
$str!!) `
,!!` a
	ErrorType!!b k
,!!k l
	errorCode!!m v
,!!v w
ex!!x z
.!!z {
Message	!!{ ‚
)
!!‚ ƒ
;
!!ƒ „
context"" 
."" 
Response"" $
.""$ %
Redirect""% -
(""- .
$str"". C
)""C D
;""D E
return## 
;## 
}$$ 
else&& 
if&& 
(&& 
ex&& 
is&& 
SqlException&& +
)&&+ ,
{'' 
	ErrorType(( 
=(( 
_configuration((  .
[((. /
$str((/ C
]((C D
??((E G
$str((H d
;((d e
	errorCode)) 
=)) 
$str))  8
;))8 9
}** 
else++ 
{,, 
	errorCode-- 
=-- 
$str--  =
;--= >
}.. 
_logger// 
.// 
LogError//  
(//  !
ex//! #
,//# $
$str//% \
,//\ ]
	ErrorType//^ g
,//g h
	errorCode//i r
,//r s
ex//t v
.//v w
Message//w ~
)//~ 
;	// €
context33 
.33 
Response33  
.33  !
Redirect33! )
(33) *
$str33* 2
)332 3
;333 4
}55 
}66 	
}77 
}88 ô.
LD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Mappings\ViewModelMapper.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Mappings 
{ 
public 

class 
ViewModelMapper  
:! "
Profile# *
{		 
public

 
ViewModelMapper

 
(

 
)

  
{ 	
	CreateMap 
< 
SiteViewModel #
,# $
SiteDto% ,
>, -
(- .
). /
./ 0

ReverseMap0 :
(: ;
); <
;< =
	CreateMap 
<  
SiteTraineeViewModel *
,* +
SiteTraineeDto, :
>: ;
(; <
)< =
.= >

ReverseMap> H
(H I
)I J
;J K
	CreateMap 
<  
AddTrainingViewModel *
,* +
TrainingDto, 7
>7 8
(8 9
)9 :
.: ;

ReverseMap; E
(E F
)F G
;G H
	CreateMap 
< 
TrainerTraining %
,% &
TrainerTrainingDto' 9
>9 :
(: ;
); <
.< =

ReverseMap= G
(G H
)H I
;I J
	CreateMap 
< 
TrainerTrainingDto (
,( )
TrainingViewModel* ;
>; <
(< =
)= >
.> ?

ReverseMap? I
(I J
)J K
;K L
	CreateMap 
< 

TraineeDto  
,  !#
TraineeTrainerViewModel" 9
>9 :
(: ;
); <
.< =

ReverseMap= G
(G H
)H I
;I J
	CreateMap 
< 

TraineeDto  
,  !
TrainerTrainedModel" 5
>5 6
(6 7
)7 8
.8 9

ReverseMap9 C
(C D
)D E
;E F
	CreateMap 
< 
EditTrainingDto %
,% &!
EditTrainingViewModel' <
>< =
(= >
)> ?
.? @

ReverseMap@ J
(J K
)K L
;L M
	CreateMap 
< 
TrainerHistoryDto '
,' ( 
TrainingHistoryModel) =
>= >
(> ?
)? @
.@ A

ReverseMapA K
(K L
)L M
;M N
	CreateMap 
< 
TrainerTrainedDto '
,' (#
TrainerTrainedViewModel) @
>@ A
(A B
)B C
.C D

ReverseMapD N
(N O
)O P
;P Q
	CreateMap 
< 
NewsDto 
, 
NewsViewModel ,
>, -
(- .
). /
./ 0

ReverseMap0 :
(: ;
); <
;< =
	CreateMap 
< 
PersonDetailDto %
,% &
PersonViewModel' 6
>6 7
(7 8
)8 9
.9 :

ReverseMap: D
(D E
)E F
;F G
	CreateMap 
< 
AddPersonDto "
," #
AddPersonViewModel$ 6
>6 7
(7 8
)8 9
.9 :

ReverseMap: D
(D E
)E F
;F G
	CreateMap 
< 
EditPersonDto #
,# $
EditPersonViewModel% 8
>8 9
(9 :
): ;
.; <

ReverseMap< F
(F G
)G H
;H I
	CreateMap 
< 
UserDto 
, 
AddUserViewModel /
>/ 0
(0 1
)1 2
.2 3

ReverseMap3 =
(= >
)> ?
;? @
	CreateMap 
< 
AddUserViewModel &
,& '
UserDto( /
>/ 0
(0 1
)1 2
.2 3

ReverseMap3 =
(= >
)> ?
;? @
	CreateMap 
< 
EditUserViewModel '
,' (
UserDto) 0
>0 1
(1 2
)2 3
.3 4

ReverseMap4 >
(> ?
)? @
;@ A
	CreateMap 
< 
UserViewDto !
,! "
ViewUserViewModel# 4
>4 5
(5 6
)6 7
.7 8

ReverseMap8 B
(B C
)C D
;D E
	CreateMap 
< 
AddNewsViewModel &
,& '
NewsDto( /
>/ 0
(0 1
)1 2
.2 3

ReverseMap3 =
(= >
)> ?
;? @
	CreateMap 
< 
SiteInputDto "
," #
EditSiteViewModel$ 5
>5 6
(6 7
)7 8
.8 9

ReverseMap9 C
(C D
)D E
;E F
	CreateMap   
<   
ReportViewModel   %
,  % &
	ReportDto  ' 0
>  0 1
(  1 2
)  2 3
.  3 4

ReverseMap  4 >
(  > ?
)  ? @
;  @ A
	CreateMap!! 
<!! 
AuditLogViewModel!! '
,!!' (
AuditLogDto!!) 4
>!!4 5
(!!5 6
)!!6 7
.!!7 8

ReverseMap!!8 B
(!!B C
)!!C D
;!!D E
	CreateMap"" 
<"" &
AuditLogsArchivedViewModel"" 0
,""0 1
AuditLogArchivedDto""2 E
>""E F
(""F G
)""G H
.""H I

ReverseMap""I S
(""S T
)""T U
;""U V
}$$ 	
}%% 
}&& Ÿ3
YD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Extensions\ServiceCollectionExtension.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 

Extensions !
{ 
public		 

static		 
class		 &
ServiceCollectionExtension		 2
{

 
public 
static 
IServiceCollection ("
AddApplicationServices) ?
(? @
this@ D
IServiceCollectionE W
servicesX `
)` a
{ 	
services 
. 
AddServices  
(  !
)! "
;" #
services 
. 
AddRepositories $
($ %
)% &
;& '
return 
services 
; 
} 	
public 
static 
IServiceCollection (
AddServices) 4
(4 5
this5 9
IServiceCollection: L
servicesM U
)U V
{ 	
services 
. 
	AddScoped 
< 
IPersonsService .
,. /
PersonsService0 >
>> ?
(? @
)@ A
;A B
services 
. 
	AddScoped 
< 
ISiteService +
,+ ,
SiteService- 8
>8 9
(9 :
): ;
;; <
services 
. 
	AddScoped 
< 
IAuditLogService /
,/ 0
AuditLogService1 @
>A B
(C D
)D E
;E F
services 
. 
	AddScoped 
< 
ITrainingService /
,/ 0
TrainingService1 @
>@ A
(A B
)B C
;C D
services 
. 
	AddScoped 
< "
IStaticDropdownService 5
,5 6!
StaticDropdownService7 L
>L M
(M N
)N O
;O P
services 
. 
	AddScoped 
< !
IAccessControlService 4
,4 5 
AccessControlService6 J
>J K
(K L
)L M
;M N
services 
. 
	AddScoped 
< 
IRoleMappingService 2
,2 3
RoleMappingService4 F
>F G
(G H
)H I
;I J
services 
. 
	AddScoped 
< 
INewsService +
,+ ,
NewsService- 8
>8 9
(9 :
): ;
;; <
services 
. 
	AddScoped 
< 
IDataEntryService 0
,0 1
DataEntryService2 B
>B C
(C D
)D E
;E F
services 
. 
	AddScoped 
< 
IUserDataService /
,/ 0
UserDataService1 @
>@ A
(A B
)B C
;C D
services 
. 
	AddScoped 
< 
ILogService *
,* +

LogService, 6
>6 7
(7 8
)8 9
;9 :
services 
. 
	AddScoped 
< 
IUserService +
,+ ,
UserService- 8
>8 9
(9 :
): ;
;; <
services   
.   
	AddScoped   
<   
IReportService   -
,  - .
ReportService  / <
>  < =
(  = >
)  > ?
;  ? @
services!! 
.!! 
	AddScoped!! 
<!! $
IAuditlogArchivedService!! 7
,!!7 8#
AuditlogArchivedService!!9 P
>!!P Q
(!!Q R
)!!R S
;!!S T
return"" 
services"" 
;"" 
}## 	
public$$ 
static$$ 
IServiceCollection$$ (
AddRepositories$$) 8
($$8 9
this$$9 =
IServiceCollection$$> P
services$$Q Y
)$$Y Z
{%% 	
services'' 
.'' 
	AddScoped'' 
<'' 
IPersonsRepository'' 1
,''1 2
PersonsRepository''3 D
>''D E
(''E F
)''F G
;''G H
services(( 
.(( 
	AddScoped(( 
<(( 
ISiteRepository(( .
,((. /
SiteRepository((0 >
>((> ?
(((? @
)((@ A
;((A B
services)) 
.)) 
	AddScoped)) 
<)) 
IAuditLogRepository)) 2
,))2 3
AuditLogRepository))4 F
>))F G
())G H
)))H I
;))I J
services** 
.** 
	AddScoped** 
<** 
ITrainingRepository** 2
,**2 3
TrainingRepository**4 F
>**F G
(**G H
)**H I
;**I J
services++ 
.++ 
	AddScoped++ 
<++ $
IAccessControlRepository++ 7
,++7 8#
AccessControlRepository++9 P
>++P Q
(++Q R
)++R S
;++S T
services,, 
.,, 
	AddScoped,, 
<,, 
INewsRepository,, .
,,,. /
NewsRepository,,0 >
>,,> ?
(,,? @
),,@ A
;,,A B
services-- 
.-- 
	AddScoped-- 
<--  
IDataEntryRepository-- 3
,--3 4
DataEntryRepository--5 H
>--H I
(--I J
)--J K
;--K L
services.. 
... 
	AddScoped.. 
<.. 
IUserRepository.. .
,... /
UserRepository..0 >
>..> ?
(..? @
)..@ A
;..A B
services// 
.// 
	AddScoped// 
<// 
IReportRepository// 0
,//0 1
ReportRepository//2 B
>//B C
(//C D
)//D E
;//E F
services00 
.00 
	AddScoped00 
<00 '
IAuditlogArchivedRepository00 :
,00: ;&
AuditlogArchivedRepository00< V
>00V W
(00W X
)00X Y
;00Y Z
return11 
services11 
;11 
}22 	
}33 
}44 §
PD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Extensions\SerilogExtensions.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 

Extensions !
{		 
public

 

static

 
class

 
SerilogExtensions

 )
{ 
public 
static 
LoggerConfiguration )
UseAwsCloudWatch* :
(: ;
this; ?
LoggerConfiguration@ S
loggerConfigurationT g
,g h
IConfigurationi w
configuration	x …
)
… †
{ 	
var 
cloudWatchClient  
=! "
new# &&
AmazonCloudWatchLogsClient' A
(A B
)B C
;C D
var 
cloudWatchOptions !
=" #
new$ '!
CloudWatchSinkOptions( =
{ 
LogGroupName 
= 
configuration ,
[, -
$str- F
]F G
,G H!
LogStreamNameProvider %
=& '
new( +$
DefaultLogStreamProvider, D
(D E
)E F
,F G
TextFormatter 
= 
new  #(
RenderedCompactJsonFormatter$ @
(@ A
)A B
,B C 
MinimumLogEventLevel $
=% &
LogEventLevel' 4
.4 5
Error5 :
,: ;
CreateLogGroup 
=  
true! %
,% &
BatchSizeLimit 
=  
$num! $
,$ %
Period 
= 
TimeSpan !
.! "
FromSeconds" -
(- .
$num. 0
)0 1
,1 2
} 
; 
return   
loggerConfiguration   &
.!! 
Enrich!! 
.!! 
FromLogContext!! %
(!!% &
)!!& '
."" 
WriteTo"" 
."" 
Console"" 
(""  
)""  !
.## 
WriteTo## 
.## 
AmazonCloudWatch## (
(##( )
cloudWatchOptions##) :
,##: ;
cloudWatchClient##< L
)##L M
;##M N
}%% 	
}&& 
}'' Ç$
PD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Extensions\Program.Extension.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 

Extensions !
{		 
public

 

static

 
class

 
ProgramExtension

 (
{ 
public 
static 
void 
ConfigureServices ,
(, -
this- 1!
WebApplicationBuilder2 G
builderH O
)O P
{ 	
var 
services 
= 
builder "
." #
Services# +
;+ ,
var 
configuration 
= 
builder  '
.' (
Configuration( 5
;5 6
services 
. 
AddDbContext !
<! "

BstContext" ,
>, -
(- .
options. 5
=>6 8
options 
. 
UseSqlServer $
($ %
configuration% 2
.2 3
GetConnectionString3 F
(F G
$strG \
)\ ]
?? 
throw 
new %
InvalidOperationException 6
(6 7
$str7 t
)t u
)u v
)v w
;w x
services 
. 
AddAutoMapper "
(" #
typeof# )
() *
EntityMapper* 6
)6 7
.7 8
Assembly8 @
)@ A
;A B
services 
. 
AddAutoMapper "
(" #
typeof# )
() *
ViewModelMapper* 9
)9 :
): ;
;; <
services 
. #
AddControllersWithViews ,
(, -
)- .
;. /
services 
. "
AddApplicationServices +
(+ ,
), -
;- .
services!! 
.!! %
AddAuthenticationServices!! .
(!!. /
configuration!!/ <
)!!< =
;!!= >
services$$ 
.$$ "
AddHttpContextAccessor$$ +
($$+ ,
)$$, -
;$$- .
services'' 
.'' 
AddHealthChecks'' $
(''$ %
)''% &
;''& '
}(( 	
public** 
static** 
void** 
ConfigureMiddleware** .
(**. /
this**/ 3
WebApplication**4 B
app**C F
)**F G
{++ 	
var,, 
env,, 
=,, 
app,, 
.,, 
Environment,, %
;,,% &
app// 
.// 
MapHealthChecks// 
(//  
$str//  )
,//) *
new//+ .
HealthCheckOptions/// A
{00 
	Predicate11 
=11 
_11 
=>11  
false11! &
}22 
)22 
;22 
if55 
(55 
env55 
.55 
IsDevelopment55 !
(55! "
)55" #
||55$ &
env55' *
.55* +
IsEnvironment55+ 8
(558 9
$str559 @
)55@ A
)55A B
{66 
app77 
.77 %
UseDeveloperExceptionPage77 -
(77- .
)77. /
;77/ 0
}88 
else99 
{:: 
app;; 
.;; 
UseExceptionHandler;; '
(;;' (
$str;;( 0
);;0 1
;;;1 2
}<< 
app>> 
.>> 
UseHsts>> 
(>> 
)>> 
;>> 
app?? 
.?? 
UseHttpsRedirection?? #
(??# $
)??$ %
;??% &
app@@ 
.@@ 
UseStaticFiles@@ 
(@@ 
)@@  
;@@  !
appBB 
.BB 

UseRoutingBB 
(BB 
)BB 
;BB 
appDD 
.DD 
UseMiddlewareDD 
<DD 
ExceptionMiddlewareDD 1
>DD1 2
(DD2 3
)DD3 4
;DD4 5
appFF 
.FF 
UseAuthenticationFF !
(FF! "
)FF" #
;FF# $
appGG 
.GG 
UseAuthorizationGG  
(GG  !
)GG! "
;GG" #
appLL 
.LL 
MapControllerRouteLL "
(LL" #
nameMM 
:MM 
$strMM 
,MM  
patternNN 
:NN 
$strNN A
)NNA B
;NNB C
}OO 	
}PP 
}QQ ¹@
VD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Extensions\AuthenticationExtension.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 

Extensions !
{ 
public		 

static		 
class		 #
AuthenticationExtension		 /
{

 
public 
static 
IServiceCollection (%
AddAuthenticationServices) B
(B C
thisC G
IServiceCollectionH Z
services[ c
,c d
IConfiguratione s
configuration	t 
)
 ‚
{ 	
services 
. 
AddAuthentication &
(& '!
OpenIdConnectDefaults' <
.< = 
AuthenticationScheme= Q
)Q R
. &
AddMicrosoftIdentityWebApp (
(( )
options) 0
=>1 3
{ 
configuration 
. 
Bind #
(# $
$str$ -
,- .
options/ 6
)6 7
;7 8
options 
. 
Events 
=  !
new" %
OpenIdConnectEvents& 9
{ 
OnTokenValidated %
=& '
context( /
=>0 2%
HandleTokenValidatedAsync3 L
(L M
contextM T
)T U
,U V(
OnRedirectToIdentityProvider 1
=2 3
context4 ;
=>< >,
 HandleRedirectToIdentityProvider? _
(_ `
context` g
)g h
,h i
OnRemoteFailure $
=% &
context' .
=>/ 1
HandleRemoteFailure2 E
(E F
contextF M
)M N
} 
; 
} 
) 
; 
return 
services 
; 
} 	
private 
static 
async 
Task !%
HandleTokenValidatedAsync" ;
(; <!
TokenValidatedContext< Q
contextR Y
)Y Z
{ 	
var 
identity 
= 
context "
." #
	Principal# ,
?, -
.- .
Identity. 6
as7 9
ClaimsIdentity: H
;H I
if   
(   
identity   
==   
null    
)    !
{!! 
throw"" 
new"" '
UnauthorizedAccessException"" 5
(""5 6
$str""6 K
)""K L
;""L M
}## 
var$$ 
email$$ 
=$$ 
identity$$  
.$$  !
	FindFirst$$! *
($$* +

ClaimTypes$$+ 5
.$$5 6
Email$$6 ;
)$$; <
?$$< =
.$$= >
Value$$> C
??%% 
identity%% !
.%%! "
	FindFirst%%" +
(%%+ ,
$str%%, @
)%%@ A
?%%A B
.%%B C
Value%%C H
;%%H I
if&& 
(&& 
!&& 
string&& 
.&& 
IsNullOrEmpty&& %
(&&% &
email&&& +
)&&+ ,
)&&, -
{'' 
var((  
accessControlService(( (
=(() *
context((+ 2
.((2 3
HttpContext((3 >
.((> ?
RequestServices((? N
.((N O
GetRequiredService((O a
<((a b!
IAccessControlService((b w
>((w x
(((x y
)((y z
;((z {
var)) 
roleMappingService)) &
=))' (
context))) 0
.))0 1
HttpContext))1 <
.))< =
RequestServices))= L
.))L M
GetRequiredService))M _
<))_ `
IRoleMappingService))` s
>))s t
())t u
)))u v
;))v w
var** 
result** 
=** 
await** " 
accessControlService**# 7
.**7 8,
 GetRoleIdAndUsernameByEmailAsync**8 X
(**X Y
email**Y ^
)**^ _
;**_ `
if,, 
(,, 
result,, 
?,, 
.,, 
RoleId,, "
!=,,# %
null,,& *
),,* +
{-- 
string.. 
roleName.. #
=..$ %
await..& +
roleMappingService.., >
...> ?
GetRoleName..? J
(..J K
result..K Q
...Q R
Value..R W
...W X
RoleId..X ^
...^ _
Value.._ d
)..d e
;..e f
string// 
username// #
=//$ %
result//& ,
.//, -
Value//- 2
.//2 3
Username//3 ;
!//; <
;//< =
identity11 
.11 
AddClaim11 %
(11% &
new11& )
Claim11* /
(11/ 0
$str110 :
,11: ;
roleName11< D
)11D E
)11E F
;11F G
identity22 
.22 
AddClaim22 %
(22% &
new22& )
Claim22* /
(22/ 0

ClaimTypes220 :
.22: ;
Name22; ?
,22? @
username22A I
.22I J
ToString22J R
(22R S
)22S T
)22T U
)22U V
;22V W
identity33 
.33 
AddClaim33 %
(33% &
new33& )
Claim33* /
(33/ 0
$str330 8
,338 9
result33: @
.33@ A
Value33A F
.33F G
RoleId33G M
.33M N
Value33N S
.33S T
ToString33T \
(33\ ]
)33] ^
)33^ _
)33_ `
;33` a
}44 
else55 
{66 
throw77 
new77 '
UnauthorizedAccessException77 9
(779 :
$"77: <
$str77< X
{77X Y
email77Y ^
}77^ _
"77_ `
)77` a
;77a b
}88 
}:: 
else;; 
{<< 
throw== 
new== '
UnauthorizedAccessException== 5
(==5 6
$str==6 ]
)==] ^
;==^ _
}>> 
}?? 	
privateJJ 
staticJJ 
TaskJJ ,
 HandleRedirectToIdentityProviderJJ <
(JJ< =
RedirectContextJJ= L
contextJJM T
)JJT U
{KK 	
ifMM 
(MM 
contextMM 
.MM 
ProtocolMessageMM '
.MM' (
RedirectUriMM( 3
?MM3 4
.MM4 5

StartsWithMM5 ?
(MM? @
$strMM@ I
,MMI J
StringComparisonMMK [
.MM[ \
OrdinalIgnoreCaseMM\ m
)MMm n
==MMo q
trueMMr v
)MMv w
{NN 
contextPP 
.PP 
ProtocolMessagePP '
.PP' (
RedirectUriPP( 3
=PP4 5
stringQQ 
.QQ 
ConcatQQ !
(QQ! "
$strQQ" ,
,QQ, -
contextQQ. 5
.QQ5 6
ProtocolMessageQQ6 E
.QQE F
RedirectUriQQF Q
.QQQ R
AsSpanQQR X
(QQX Y
$strQQY b
.QQb c
LengthQQc i
)QQi j
)QQj k
;QQk l
}RR 
returnSS 
TaskSS 
.SS 
CompletedTaskSS %
;SS% &
}TT 	
privateVV 
staticVV 
TaskVV 
HandleRemoteFailureVV /
(VV/ 0 
RemoteFailureContextVV0 D
contextVVE L
)VVL M
{WW 	
ifXX 
(XX 
contextXX 
.XX 
FailureXX 
?XX  
.XX  !
InnerExceptionXX! /
isXX0 2'
UnauthorizedAccessExceptionXX3 N
unauthorizedExXXO ]
)XX] ^
{YY 
throwZZ 
unauthorizedExZZ $
;ZZ$ %
}[[ 
throw]] 
context]] 
.]] 
Failure]] !
??]]" $
new]]% (
	Exception]]) 2
(]]2 3
$str]]3 R
)]]R S
;]]S T
}^^ 	
}__ 
}`` ¢’
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\UserController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
UserController 
:  !

Controller" ,
{ 
private 
readonly 
IUserService %
_userService& 2
;2 3
private 
readonly 
IRoleMappingService ,
_roleMappingService- @
;@ A
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
ILogService $
_logService% 0
;0 1
private 
const 
string 
userMessage (
=) *
$str+ 8
;8 9
public 
UserController 
( 
IUserService *
userService+ 6
,6 7
IRoleMappingService8 K
roleMappingServiceL ^
,^ _
IMapper` g
mapperh n
,n o
IUserDataService	p €
userDataService
 
,
 ‘
ILogService
’ 

logService
ž ¨
)
¨ ©
{ 	
_userService 
= 
userService &
;& '
_roleMappingService 
=  !
roleMappingService" 4
;4 5
_mapper 
= 
mapper 
; 
_userDataService 
= 
userDataService .
;. /
_logService 
= 

logService $
;$ %
}   	
["" 	
HttpGet""	 
]"" 
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
AddUser##) 0
(##0 1
)##1 2
{$$ 	
bool%% 
canEdit%% 
=%% 
await%%  
_userDataService%%! 1
.%%1 2
CanEditPage%%2 =
(%%= >
ControllerContext%%> O
.%%O P
ActionDescriptor%%P `
.%%` a

ActionName%%a k
)%%k l
;%%l m
var'' 
	viewModel'' 
='' 
new'' 
AddUserViewModel''  0
{(( 
	Locations)) 
=)) 
()) 
await)) "
_userService))# /
.))/ 0
GetLocationsAsync))0 A
())A B
)))B C
)))C D
.** 
Select** 
(** 
l** 
=>**  
new**! $
SelectListItem**% 3
{**4 5
Value**6 ;
=**< =
l**> ?
.**? @
LocId**@ E
,**E F
Text**G K
=**L M
l**N O
.**O P
VlaLocation**P [
}**\ ]
)**] ^
.++ 
ToList++ 
(++ 
)++ 
,++ 

UserLevels,, 
=,, 
_roleMappingService,, 0
.,,0 1
GetUserLevels,,1 >
(,,> ?
),,? @
,,,@ A
	UserLevel-- 
=-- 
$num-- 
,-- 
CanEdit.. 
=.. 
canEdit.. !
}// 
;// 
return00 
View00 
(00 
	viewModel00 !
)00! "
;00" #
}11 	
[44 	
HttpPost44	 
]44 
[55 	$
ValidateAntiForgeryToken55	 !
]55! "
public66 
async66 
Task66 
<66 
IActionResult66 '
>66' (
AddUser66) 0
(660 1
AddUserViewModel661 A
	viewModel66B K
)66K L
{77 	
bool88 
canEdit88 
=88 
await88  
_userDataService88! 1
.881 2
CanEditPage882 =
(88= >
ControllerContext88> O
.88O P
ActionDescriptor88P `
.88` a

ActionName88a k
)88k l
;88l m
if99 
(99 
!99 

ModelState99 
.99 
IsValid99 #
)99# $
{:: 
	viewModel;; 
.;; 
	Locations;; #
=;;$ %
(;;& '
await;;' ,
_userService;;- 9
.;;9 :
GetLocationsAsync;;: K
(;;K L
);;L M
);;M N
.<< 
Select<< 
(<< 
l<< 
=><<  
new<<! $
SelectListItem<<% 3
{<<4 5
Value<<6 ;
=<<< =
l<<> ?
.<<? @
LocId<<@ E
,<<E F
Text<<G K
=<<L M
l<<N O
.<<O P
VlaLocation<<P [
}<<\ ]
)<<] ^
.== 
ToList== 
(== 
)== 
;== 
	viewModel>> 
.>> 

UserLevels>> $
=>>% &
_roleMappingService>>' :
.>>: ;
GetUserLevels>>; H
(>>H I
)>>I J
;>>J K
	viewModel?? 
.?? 
CanEdit?? !
=??" #
canEdit??$ +
;??+ ,
return@@ 
View@@ 
(@@ 
	viewModel@@ %
)@@% &
;@@& '
}AA 
tryCC 
{DD 
ifEE 
(EE 
canEditEE 
)EE 
{FF 
varGG 
dtoGG 
=GG 
_mapperGG %
.GG% &
MapGG& )
<GG) *
UserDtoGG* 1
>GG1 2
(GG2 3
	viewModelGG3 <
)GG< =
;GG= >
TempDataHH 
[HH 
userMessageHH (
]HH( )
=HH* +
awaitHH, 1
_userServiceHH2 >
.HH> ?
AddUserAsyncHH? K
(HHK L
dtoHHL O
)HHO P
;HHP Q
}II 
elseJJ 
{KK 
TempDataLL 
[LL 
userMessageLL (
]LL( )
=LL* +
$strLL, `
;LL` a
}MM 
}NN 
catchOO 
(OO 
SqlExceptionOO 
sqlExOO  %
)OO% &
{PP 
_logServiceQQ 
.QQ 
LogSqlExceptionQQ +
(QQ+ ,
sqlExQQ, 1
,QQ1 2
ControllerContextQQ3 D
.QQD E
ActionDescriptorQQE U
.QQU V

ActionNameQQV `
)QQ` a
;QQa b
TempDataRR 
[RR 
userMessageRR $
]RR$ %
=RR& '
$strRR( 5
;RR5 6
}SS 
catchTT 
(TT 
	ExceptionTT 
exTT 
)TT  
{UU 
_logServiceVV 
.VV 
LogGeneralExceptionVV /
(VV/ 0
exVV0 2
,VV2 3
ControllerContextVV4 E
.VVE F
ActionDescriptorVVF V
.VVV W

ActionNameVVW a
)VVa b
;VVb c
TempDataWW 
[WW 
userMessageWW $
]WW$ %
=WW& '
$strWW( 5
;WW5 6
}XX 
returnYY 
RedirectToActionYY #
(YY# $
nameofYY$ *
(YY* +
AddUserYY+ 2
)YY2 3
)YY3 4
;YY4 5
}ZZ 	
[\\ 	
HttpGet\\	 
]\\ 
public]] 
async]] 
Task]] 
<]] 
IActionResult]] '
>]]' (
ViewUser]]) 1
(]]1 2
string]]2 8
selectedUserId]]9 G
=]]H I
$str]]J U
)]]U V
{^^ 	
bool__ 
canEdit__ 
=__ 
await__  
_userDataService__! 1
.__1 2
CanEditPage__2 =
(__= >
ControllerContext__> O
.__O P
ActionDescriptor__P `
.__` a

ActionName__a k
)__k l
;__l m
varaa 
allUsersaa 
=aa 
awaitaa  
_userServiceaa! -
.aa- .
GetUsersAsyncaa. ;
(aa; <
selectedUserIdaa< J
)aaJ K
;aaK L
varbb 
userListbb 
=bb 
awaitbb  
_userServicebb! -
.bb- .
GetUsersAsyncbb. ;
(bb; <
$strbb< G
)bbG H
;bbH I
vardd 
	viewModeldd 
=dd 
newdd 
ViewUserViewModeldd  1
{ee 
SelectedUserIdff 
=ff  
selectedUserIdff! /
,ff/ 0
Usersgg 
=gg 
userListgg  
.gg  !
Selectgg! '
(gg' (
ugg( )
=>gg* ,
newgg- 0
SelectListItemgg1 ?
{gg@ A
ValueggB G
=ggH I
uggJ K
.ggK L
UserIdggL R
,ggR S
TextggT X
=ggY Z
ugg[ \
.gg\ ]
UserNamegg] e
}ggf g
)ggg h
,ggh i
UserListhh 
=hh 
allUsershh #
,hh# $
CanEditii 
=ii 
canEditii !
}jj 
;jj 
returnkk 
Viewkk 
(kk 
	viewModelkk !
)kk! "
;kk" #
}mm 	
[oo 	
HttpGetoo	 
]oo 
publicpp 
asyncpp 
Taskpp 
<pp 
IActionResultpp '
>pp' (
EditUserpp) 1
(pp1 2
stringpp2 8
userIdpp9 ?
)pp? @
{qq 	
boolrr 
canEditrr 
=rr 
awaitrr  
_userDataServicerr! 1
.rr1 2
CanEditPagerr2 =
(rr= >
ControllerContextrr> O
.rrO P
ActionDescriptorrrP `
.rr` a

ActionNamerra k
)rrk l
;rrl m
varss 
dtoss 
=ss 
awaitss 
_userServicess (
.ss( )
GetUserByIdAsyncss) 9
(ss9 :
userIdss: @
)ss@ A
;ssA B
iftt 
(tt 
dtott 
==tt 
nulltt 
)tt 
{uu 
TempDatavv 
[vv 
userMessagevv $
]vv$ %
=vv& '
$strvv( 7
;vv7 8
returnww 
RedirectToActionww '
(ww' (
nameofww( .
(ww. /
ViewUserww/ 7
)ww7 8
)ww8 9
;ww9 :
}xx 
varzz 
	viewModelzz 
=zz 
_mapperzz #
.zz# $
Mapzz$ '
<zz' (
EditUserViewModelzz( 9
>zz9 :
(zz: ;
dtozz; >
)zz> ?
;zz? @
	viewModel{{ 
.{{ 
	Locations{{ 
={{  !
({{" #
await{{# (
_userService{{) 5
.{{5 6
GetLocationsAsync{{6 G
({{G H
){{H I
){{I J
.{{J K
Select{{K Q
({{Q R
l{{R S
=>{{T V
new{{W Z
SelectListItem{{[ i
{{{j k
Value{{l q
={{r s
l{{t u
.{{u v
LocId{{v {
,{{{ |
Text	{{} 
=
{{‚ ƒ
l
{{„ …
.
{{… †
VlaLocation
{{† ‘
}
{{’ “
)
{{“ ”
;
{{” •
	viewModel|| 
.|| 

UserLevels||  
=||! "
_roleMappingService||# 6
.||6 7
GetUserLevels||7 D
(||D E
)||E F
;||F G
	viewModel}} 
.}} 
CanEdit}} 
=}} 
canEdit}}  '
;}}' (
return~~ 
View~~ 
(~~ 
	viewModel~~ !
)~~! "
;~~" #
} 	
[
 	
HttpPost
	 
]
 
[
‚‚ 	&
ValidateAntiForgeryToken
‚‚	 !
]
‚‚! "
public
ƒƒ 
async
ƒƒ 
Task
ƒƒ 
<
ƒƒ 
IActionResult
ƒƒ '
>
ƒƒ' (
EditUser
ƒƒ) 1
(
ƒƒ1 2
EditUserViewModel
ƒƒ2 C
	viewModel
ƒƒD M
)
ƒƒM N
{
„„ 	
bool
…… 
canEdit
…… 
=
…… 
await
……  
_userDataService
……! 1
.
……1 2
CanEditPage
……2 =
(
……= >
ControllerContext
……> O
.
……O P
ActionDescriptor
……P `
.
……` a

ActionName
……a k
)
……k l
;
……l m
if
†† 
(
†† 
!
†† 

ModelState
†† 
.
†† 
IsValid
†† #
)
††# $
{
‡‡ 
	viewModel
ˆˆ 
.
ˆˆ 
	Locations
ˆˆ #
=
ˆˆ$ %
(
ˆˆ& '
await
ˆˆ' ,
_userService
ˆˆ- 9
.
ˆˆ9 :
GetLocationsAsync
ˆˆ: K
(
ˆˆK L
)
ˆˆL M
)
ˆˆM N
.
ˆˆN O
Select
ˆˆO U
(
ˆˆU V
l
ˆˆV W
=>
ˆˆX Z
new
ˆˆ[ ^
SelectListItem
ˆˆ_ m
{
ˆˆn o
Value
ˆˆp u
=
ˆˆv w
l
ˆˆx y
.
ˆˆy z
LocId
ˆˆz 
,ˆˆ €
Textˆˆ …
=ˆˆ† ‡
lˆˆˆ ‰
.ˆˆ‰ Š
VlaLocationˆˆŠ •
}ˆˆ– —
)ˆˆ— ˜
;ˆˆ˜ ™
	viewModel
‰‰ 
.
‰‰ 

UserLevels
‰‰ $
=
‰‰% &!
_roleMappingService
‰‰' :
.
‰‰: ;
GetUserLevels
‰‰; H
(
‰‰H I
)
‰‰I J
;
‰‰J K
	viewModel
ŠŠ 
.
ŠŠ 
CanEdit
ŠŠ !
=
ŠŠ" #
canEdit
ŠŠ$ +
;
ŠŠ+ ,
return
‹‹ 
View
‹‹ 
(
‹‹ 
	viewModel
‹‹ %
)
‹‹% &
;
‹‹& '
}
ŒŒ 
try
 
{
ŽŽ 
if
 
(
 
canEdit
 
)
 
{
 
var
‘‘ 
dto
‘‘ 
=
‘‘ 
_mapper
‘‘ %
.
‘‘% &
Map
‘‘& )
<
‘‘) *
UserDto
‘‘* 1
>
‘‘1 2
(
‘‘2 3
	viewModel
‘‘3 <
)
‘‘< =
;
‘‘= >
TempData
’’ 
[
’’ 
userMessage
’’ (
]
’’( )
=
’’* +
await
’’, 1
_userService
’’2 >
.
’’> ?
UpdateUserAsync
’’? N
(
’’N O
dto
’’O R
)
’’R S
;
’’S T
}
““ 
else
”” 
{
•• 
TempData
–– 
[
–– 
userMessage
–– (
]
––( )
=
––* +
$str
––, `
;
––` a
}
—— 
}
˜˜ 
catch
™™ 
(
™™ 
SqlException
™™ 
sqlEx
™™  %
)
™™% &
{
šš 
_logService
›› 
.
›› 
LogSqlException
›› +
(
››+ ,
sqlEx
››, 1
,
››1 2
ControllerContext
››3 D
.
››D E
ActionDescriptor
››E U
.
››U V

ActionName
››V `
)
››` a
;
››a b
TempData
œœ 
[
œœ 
userMessage
œœ $
]
œœ$ %
=
œœ& '
$str
œœ( 7
;
œœ7 8
}
 
catch
žž 
(
žž 
	Exception
žž 
ex
žž 
)
žž  
{
ŸŸ 
_logService
   
.
   !
LogGeneralException
   /
(
  / 0
ex
  0 2
,
  2 3
ControllerContext
  4 E
.
  E F
ActionDescriptor
  F V
.
  V W

ActionName
  W a
)
  a b
;
  b c
TempData
¡¡ 
[
¡¡ 
userMessage
¡¡ $
]
¡¡$ %
=
¡¡& '
$str
¡¡( 7
;
¡¡7 8
}
¢¢ 
return
££ 
RedirectToAction
££ #
(
££# $
nameof
££$ *
(
££* +
ViewUser
££+ 3
)
££3 4
)
££4 5
;
££5 6
}
¤¤ 	
[
§§ 	
HttpPost
§§	 
]
§§ 
public
¨¨ 
async
¨¨ 
Task
¨¨ 
<
¨¨ 
IActionResult
¨¨ '
>
¨¨' (

DeleteUser
¨¨) 3
(
¨¨3 4
string
¨¨4 :
userId
¨¨; A
)
¨¨A B
{
©© 	
bool
ªª 
canEdit
ªª 
=
ªª 
await
ªª  
_userDataService
ªª! 1
.
ªª1 2
CanEditPage
ªª2 =
(
ªª= >
ControllerContext
ªª> O
.
ªªO P
ActionDescriptor
ªªP `
.
ªª` a

ActionName
ªªa k
)
ªªk l
;
ªªl m
try
«« 
{
¬¬ 
if
­­ 
(
­­ 
canEdit
­­ 
)
­­ 
{
®® 
var
¯¯ 
message
¯¯ 
=
¯¯  !
await
¯¯" '
_userService
¯¯( 4
.
¯¯4 5
DeleteUserAsync
¯¯5 D
(
¯¯D E
userId
¯¯E K
)
¯¯K L
;
¯¯L M
TempData
°° 
[
°° 
userMessage
°° (
]
°°( )
=
°°* +
message
°°, 3
;
°°3 4
}
±± 
}
²² 
catch
³³ 
(
³³ 
SqlException
³³ 
sqlEx
³³  %
)
³³% &
{
´´ 
_logService
µµ 
.
µµ 
LogSqlException
µµ +
(
µµ+ ,
sqlEx
µµ, 1
,
µµ1 2
ControllerContext
µµ3 D
.
µµD E
ActionDescriptor
µµE U
.
µµU V

ActionName
µµV `
)
µµ` a
;
µµa b
TempData
¶¶ 
[
¶¶ 
userMessage
¶¶ $
]
¶¶$ %
=
¶¶& '
$str
¶¶( 7
;
¶¶7 8
}
·· 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
ex
¸¸ 
)
¸¸  
{
¹¹ 
_logService
ºº 
.
ºº !
LogGeneralException
ºº /
(
ºº/ 0
ex
ºº0 2
,
ºº2 3
ControllerContext
ºº4 E
.
ººE F
ActionDescriptor
ººF V
.
ººV W

ActionName
ººW a
)
ººa b
;
ººb c
TempData
»» 
[
»» 
userMessage
»» $
]
»»$ %
=
»»& '
$str
»»( 7
;
»»7 8
}
¼¼ 
return
½½ 
RedirectToAction
½½ #
(
½½# $
nameof
½½$ *
(
½½* +
ViewUser
½½+ 3
)
½½3 4
)
½½4 5
;
½½5 6
}
¾¾ 	
}
¿¿ 
}ÀÀ •Å
RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\TrainingController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
TrainingController #
:$ %

Controller& 0
{ 
private 
readonly 
ITrainingService )
_trainingService* :
;: ;
private 
readonly 
ILogService $
_logService% 0
;0 1
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly "
IStaticDropdownService /"
_staticDropdownService0 F
;F G
private 
const 
string 

traineeAll '
=( )
$str* /
;/ 0
private 
const 
string 
trainingMessage ,
=- .
$str/ 8
;8 9
public 
TrainingController !
(! "
ILogService" -

logService. 8
,8 9
ITrainingService: J
trainingServiceK Z
,Z [
IMapper\ c
mapperd j
,j k#
IStaticDropdownService	l ‚#
staticDropdownService
ƒ ˜
,
˜ ™
IUserDataService
š ª
userDataService
« º
)
º »
{ 	
_trainingService 
= 
trainingService .
;. /
_mapper 
= 
mapper 
; "
_staticDropdownService   "
=  # $!
staticDropdownService  % :
;  : ;
_userDataService!! 
=!! 
userDataService!! .
;!!. /
_logService"" 
="" 

logService"" $
;""$ %
}## 	
public$$ 
IActionResult$$ 
Index$$ "
($$" #
)$$# $
{%% 	
return&& 
View&& 
(&& 
)&& 
;&& 
}'' 	
[(( 	
HttpGet((	 
](( 
public)) 
async)) 
Task)) 
<)) 
IActionResult)) '
>))' (
AddTraining))) 4
())4 5
)))5 6
{** 	
bool++ 
canEdit++ 
=++ 
await++  
_userDataService++! 1
.++1 2
CanEditPage++2 =
(++= >
ControllerContext++> O
.++O P
ActionDescriptor++P `
.++` a

ActionName++a k
)++k l
;++l m
var,, 
	viewModel,, 
=,, 
new,,  
AddTrainingViewModel,,  4
{-- 
CanEdit.. 
=.. 
canEdit.. !
,..! "
Persons// 
=// 
(// 
await//  
_trainingService//! 1
.//1 2
GetTraineesAsync//2 B
(//B C
)//C D
)//D E
.00 
Select00 
(00 
p00 
=>00  
new00! $
SelectListItem00% 3
{004 5
Value006 ;
=00< =
p00> ?
.00? @
PersonId00@ H
.00H I
ToString00I Q
(00Q R
)00R S
,00S T
Text00U Y
=00Z [
p00\ ]
.00] ^
Person00^ d
}00e f
)00f g
.11 
ToList11 
(11 
)11 
}22 
;22 
	viewModel44 
.44 
TrainingTypesList44 '
=44( )"
_staticDropdownService44* @
.44@ A
GetTrainingTypes44A Q
(44Q R
)44R S
.55 
Select55 
(55 
t55 
=>55 
new55 !
SelectListItem55" 0
{551 2
Value553 8
=559 :
t55; <
.55< =
Value55= B
,55B C
Text55D H
=55I J
t55K L
.55L M
Text55M Q
}55R S
)55S T
.66 
ToList66 
(66 
)66 
;66 
	viewModel88 
.88 
TrainingAnimalList88 (
=88) *"
_staticDropdownService88+ A
.88A B
GetTrainingAnimal88B S
(88S T
)88T U
.99 
Select99 
(99 
t99 
=>99 
new99 
SelectListItem99  .
{99/ 0
Value991 6
=997 8
t999 :
.99: ;
Value99; @
,99@ A
Text99B F
=99G H
t99I J
.99J K
Text99K O
}99P Q
)99Q R
.:: 
ToList:: 
(:: 
):: 
;:: 
	viewModel;; 
.;; 
TrainingDateTime;; &
=;;' (
DateTime;;) 1
.;;1 2
Today;;2 7
;;;7 8
return<< 
View<< 
(<< 
	viewModel<< !
)<<! "
;<<" #
}== 	
[?? 	
HttpPost??	 
]?? 
[@@ 	$
ValidateAntiForgeryToken@@	 !
]@@! "
publicAA 
asyncAA 
TaskAA 
<AA 
IActionResultAA '
>AA' (
AddTrainingAA) 4
(AA4 5 
AddTrainingViewModelAA5 I
	viewModelAAJ S
)AAS T
{BB 	
boolCC 
canEditCC 
=CC 
awaitCC  
_userDataServiceCC! 1
.CC1 2
CanEditPageCC2 =
(CC= >
ControllerContextCC> O
.CCO P
ActionDescriptorCCP `
.CC` a

ActionNameCCa k
)CCk l
;CCl m
	viewModelDD 
.DD 
CanEditDD 
=DD 
canEditDD  '
;DD' (
ifEE 
(EE 
!EE 

ModelStateEE 
.EE 
IsValidEE #
)EE# $
{FF 
	viewModelGG 
.GG 
PersonsGG !
=GG" #
(GG$ %
awaitGG% *
_trainingServiceGG+ ;
.GG; <
GetTraineesAsyncGG< L
(GGL M
)GGM N
)GGN O
.HH 
SelectHH 
(HH 
pHH 
=>HH  
newHH! $
SelectListItemHH% 3
{HH4 5
ValueHH6 ;
=HH< =
pHH> ?
.HH? @
PersonIdHH@ H
.HHH I
ToStringHHI Q
(HHQ R
)HHR S
,HHS T
TextHHU Y
=HHZ [
pHH\ ]
.HH] ^
PersonHH^ d
}HHe f
)HHf g
.II 
ToListII 
(II 
)II 
;II 
	viewModelJJ 
.JJ 
TrainingTypesListJJ +
=JJ, -"
_staticDropdownServiceJJ. D
.JJD E
GetTrainingTypesJJE U
(JJU V
)JJV W
.KK 
SelectKK 
(KK 
tKK 
=>KK 
newKK !
SelectListItemKK" 0
{KK1 2
ValueKK3 8
=KK9 :
tKK; <
.KK< =
ValueKK= B
,KKB C
TextKKD H
=KKI J
tKKK L
.KKL M
TextKKM Q
}KKR S
)KKS T
.LL 
ToListLL 
(LL 
)LL 
;LL 
	viewModelNN 
.NN 
TrainingAnimalListNN ,
=NN- ."
_staticDropdownServiceNN/ E
.NNE F
GetTrainingAnimalNNF W
(NNW X
)NNX Y
.OO 
SelectOO 
(OO 
tOO 
=>OO 
newOO  #
SelectListItemOO$ 2
{OO3 4
ValueOO5 :
=OO; <
tOO= >
.OO> ?
ValueOO? D
,OOD E
TextOOF J
=OOK L
tOOM N
.OON O
TextOOO S
}OOT U
)OOU V
.PP 
ToListPP 
(PP 
)PP 
;PP 
returnRR 
ViewRR 
(RR 
	viewModelRR %
)RR% &
;RR& '
}SS 
tryTT 
{UU 
ifVV 
(VV 
canEditVV 
)VV 
{WW 
varXX 
dtoXX 
=XX 
_mapperXX %
.XX% &
MapXX& )
<XX) *
TrainingDtoXX* 5
>XX5 6
(XX6 7
	viewModelXX7 @
)XX@ A
;XXA B
varYY 
messageYY 
=YY  !
awaitYY" '
_trainingServiceYY( 8
.YY8 9
AddTrainingAsyncYY9 I
(YYI J
dtoYYJ M
)YYM N
;YYN O
TempDataZZ 
[ZZ 
trainingMessageZZ ,
]ZZ, -
=ZZ. /
messageZZ0 7
;ZZ7 8
}[[ 
}\\ 
catch]] 
(]] 
SqlException]] 
sqlEx]]  %
)]]% &
{^^ 
_logService`` 
.`` 
LogSqlException`` +
(``+ ,
sqlEx``, 1
,``1 2
ControllerContext``3 D
.``D E
ActionDescriptor``E U
.``U V

ActionName``V `
)``` a
;``a b
TempDataaa 
[aa 
trainingMessageaa (
]aa( )
=aa* +
$straa, 9
;aa9 :
}bb 
catchcc 
(cc 
	Exceptioncc 
excc 
)cc  
{dd 
_logServiceee 
.ee 
LogGeneralExceptionee /
(ee/ 0
exee0 2
,ee2 3
ControllerContextee4 E
.eeE F
ActionDescriptoreeF V
.eeV W

ActionNameeeW a
)eea b
;eeb c
TempDataff 
[ff 
trainingMessageff (
]ff( )
=ff* +
$strff, 9
;ff9 :
}gg 
returnii 
RedirectToActionii #
(ii# $
nameofii$ *
(ii* +
AddTrainingii+ 6
)ii6 7
)ii7 8
;ii8 9
}jj 	
[ll 	
HttpGetll	 
]ll 
publicmm 
asyncmm 
Taskmm 
<mm 
IActionResultmm '
>mm' (
EditTrainingmm) 5
(mm5 6
intmm6 9
	traineeIdmm: C
,mmC D
intmmE H
	trainerIdmmI R
,mmR S
stringmmT Z
speciesmm[ b
,mmb c
DateTimemmd l
dateTrainedmmm x
,mmx y
string	mmz €
trainingType
mm 
)
mm Ž
{nn 	
booloo 
canEditoo 
=oo 
awaitoo  
_userDataServiceoo! 1
.oo1 2
CanEditPageoo2 =
(oo= >
ControllerContextoo> O
.ooO P
ActionDescriptorooP `
.oo` a

ActionNameooa k
)ook l
;ool m
ifpp 
(pp 
!pp 

ModelStatepp 
.pp 
IsValidpp #
)pp# $
{qq 
returnrr 
RedirectToActionrr '
(rr' (
nameofrr( .
(rr. /
ViewTrainingrr/ ;
)rr; <
)rr< =
;rr= >
}ss 
vartt 
dtott 
=tt 
awaittt 
_trainingServicett ,
.tt, -"
GetTrainingByKeysAsynctt- C
(ttC D
	traineeIdttD M
,ttM N
	trainerIdttO X
,ttX Y
speciesttZ a
,tta b
dateTrainedttc n
,ttn o
trainingTypettp |
)tt| }
;tt} ~
ifuu 
(uu 
dtouu 
==uu 
nulluu 
)uu 
{vv 
TempDataww 
[ww 
trainingMessageww (
]ww( )
=ww* +
$strww, Q
;wwQ R
returnxx 
RedirectToActionxx '
(xx' (
nameofxx( .
(xx. /
ViewTrainingxx/ ;
)xx; <
)xx< =
;xx= >
}yy 
varzz 
personszz 
=zz 
awaitzz 
_trainingServicezz  0
.zz0 1
GetTraineesAsynczz1 A
(zzA B
)zzB C
;zzC D
var{{ 
	viewModel{{ 
={{ 
new{{ !
EditTrainingViewModel{{  5
{|| 
CanEdit}} 
=}} 
canEdit}} !
,}}! "
	TraineeId~~ 
=~~ 
dto~~ 
.~~  
PersonId~~  (
,~~( )
	TrainerId 
= 
dto 
.  
	TrainerId  )
,) *
TrainingType
€€ 
=
€€ 
dto
€€ "
.
€€" #
TrainingType
€€# /
,
€€/ 0
TrainingAnimal
 
=
  
dto
! $
.
$ %
TrainingAnimal
% 3
,
3 4
TrainingDateTime
‚‚  
=
‚‚! "
dto
‚‚# &
.
‚‚& '
TrainingDateTime
‚‚' 7
,
‚‚7 8!
TrainingDateTimeOld
ƒƒ #
=
ƒƒ$ %
dto
ƒƒ& )
.
ƒƒ) *
TrainingDateTime
ƒƒ* :
,
ƒƒ: ;
TraineeIdOld
„„ 
=
„„ 
dto
„„ "
.
„„" #
PersonId
„„# +
,
„„+ ,
TrainerIdOld
…… 
=
…… 
dto
…… "
.
……" #
	TrainerId
……# ,
,
……, -
TrainingAnimalOld
†† !
=
††" #
dto
††$ '
.
††' (
TrainingAnimal
††( 6
,
††6 7
TrainingTypeOld
‡‡ 
=
‡‡  !
dto
‡‡" %
.
‡‡% &
TrainingType
‡‡& 2
,
‡‡2 3
}
ˆˆ 
;
ˆˆ 
	viewModel
‰‰ 
.
‰‰ 
TraineeList
‰‰ !
=
‰‰" #
persons
‰‰$ +
.
ŠŠ 
Select
ŠŠ 
(
ŠŠ 
p
ŠŠ 
=>
ŠŠ 
new
ŠŠ  
SelectListItem
ŠŠ! /
{
ŠŠ0 1
Value
ŠŠ2 7
=
ŠŠ8 9
p
ŠŠ: ;
.
ŠŠ; <
PersonId
ŠŠ< D
.
ŠŠD E
ToString
ŠŠE M
(
ŠŠM N
)
ŠŠN O
,
ŠŠO P
Text
ŠŠQ U
=
ŠŠV W
p
ŠŠX Y
.
ŠŠY Z
Person
ŠŠZ `
,
ŠŠ` a
Selected
ŠŠb j
=
ŠŠk l
p
ŠŠm n
.
ŠŠn o
PersonId
ŠŠo w
==
ŠŠx z
dto
ŠŠ{ ~
.
ŠŠ~ 
PersonIdŠŠ ‡
}ŠŠˆ ‰
)ŠŠ‰ Š
.
‹‹ 
ToList
‹‹ 
(
‹‹ 
)
‹‹ 
;
‹‹ 
	viewModel
ŒŒ 
.
ŒŒ 
TrainerList
ŒŒ !
=
ŒŒ" #
persons
ŒŒ$ +
.
 
Select
 
(
 
p
 
=>
 
new
 
SelectListItem
  .
{
/ 0
Value
1 6
=
7 8
p
9 :
.
: ;
PersonId
; C
.
C D
ToString
D L
(
L M
)
M N
,
N O
Text
P T
=
U V
p
W X
.
X Y
Person
Y _
,
_ `
Selected
a i
=
j k
p
l m
.
m n
PersonId
n v
==
w y
dto
z }
.
} ~
	TrainerId~ ‡
}ˆ ‰
)‰ Š
.
ŽŽ 
ToList
ŽŽ 
(
ŽŽ 
)
ŽŽ 
;
ŽŽ 
	viewModel
 
.
 
TrainingTypesList
 '
=
( )$
_staticDropdownService
* @
.
@ A
GetTrainingTypes
A Q
(
Q R
)
R S
.
 
Select
 
(
 
t
 
=>
 
new
 
SelectListItem
 -
{
. /
Value
0 5
=
6 7
t
8 9
.
9 :
Value
: ?
,
? @
Text
A E
=
F G
t
H I
.
I J
Text
J N
}
O P
)
P Q
.
‘‘ 
ToList
‘‘ 
(
‘‘ 
)
‘‘ 
;
‘‘ 
	viewModel
’’ 
.
’’  
TrainingAnimalList
’’ (
=
’’) *$
_staticDropdownService
’’+ A
.
’’A B
GetTrainingAnimal
’’B S
(
’’S T
)
’’T U
.
““ 
Select
““ 
(
““ 
t
““ 
=>
““ 
new
““ 
SelectListItem
““  .
{
““/ 0
Value
““1 6
=
““7 8
t
““9 :
.
““: ;
Value
““; @
,
““@ A
Text
““B F
=
““G H
t
““I J
.
““J K
Text
““K O
}
““P Q
)
““Q R
.
”” 
ToList
”” 
(
”” 
)
”” 
;
”” 
return
•• 
View
•• 
(
•• 
	viewModel
•• !
)
••! "
;
••" #
}
–– 	
[
™™ 	
HttpPost
™™	 
]
™™ 
[
šš 	&
ValidateAntiForgeryToken
šš	 !
]
šš! "
public
›› 
async
›› 
Task
›› 
<
›› 
IActionResult
›› '
>
››' (
EditTraining
››) 5
(
››5 6#
EditTrainingViewModel
››6 K
	viewModel
››L U
)
››U V
{
œœ 	
bool
 
canEdit
 
=
 
await
  
_userDataService
! 1
.
1 2
CanEditPage
2 =
(
= >
ControllerContext
> O
.
O P
ActionDescriptor
P `
.
` a

ActionName
a k
)
k l
;
l m
	viewModel
žž 
.
žž 
CanEdit
žž 
=
žž 
canEdit
žž  '
;
žž' (
if
ŸŸ 
(
ŸŸ 
!
ŸŸ 

ModelState
ŸŸ 
.
ŸŸ 
IsValid
ŸŸ #
)
ŸŸ# $
{
   
var
¡¡ 
persons
¡¡ 
=
¡¡ 
await
¡¡ #
_trainingService
¡¡$ 4
.
¡¡4 5
GetTraineesAsync
¡¡5 E
(
¡¡E F
)
¡¡F G
;
¡¡G H
	viewModel
¢¢ 
.
¢¢ 
CanEdit
¢¢ !
=
¢¢" #
canEdit
¢¢$ +
;
¢¢+ ,
	viewModel
¤¤ 
.
¤¤ 
TraineeList
¤¤ %
=
¤¤& '
persons
¤¤( /
.
¥¥ 
Select
¥¥ 
(
¥¥ 
p
¥¥ 
=>
¥¥  
new
¥¥! $
SelectListItem
¥¥% 3
{
¥¥4 5
Value
¥¥6 ;
=
¥¥< =
p
¥¥> ?
.
¥¥? @
PersonId
¥¥@ H
.
¥¥H I
ToString
¥¥I Q
(
¥¥Q R
)
¥¥R S
,
¥¥S T
Text
¥¥U Y
=
¥¥Z [
p
¥¥\ ]
.
¥¥] ^
Person
¥¥^ d
,
¥¥d e
Selected
¥¥f n
=
¥¥o p
p
¥¥q r
.
¥¥r s
PersonId
¥¥s {
==
¥¥| ~
	viewModel¥¥ ˆ
.¥¥ˆ ‰
TraineeIdOld¥¥‰ •
}¥¥– —
)¥¥— ˜
.
¦¦ 
ToList
¦¦ 
(
¦¦ 
)
¦¦ 
;
¦¦ 
	viewModel
§§ 
.
§§ 
TrainerList
§§ %
=
§§& '
persons
§§( /
.
¨¨ 
Select
¨¨ 
(
¨¨ 
p
¨¨ 
=>
¨¨ 
new
¨¨  #
SelectListItem
¨¨$ 2
{
¨¨3 4
Value
¨¨5 :
=
¨¨; <
p
¨¨= >
.
¨¨> ?
PersonId
¨¨? G
.
¨¨G H
ToString
¨¨H P
(
¨¨P Q
)
¨¨Q R
,
¨¨R S
Text
¨¨T X
=
¨¨Y Z
p
¨¨[ \
.
¨¨\ ]
Person
¨¨] c
,
¨¨c d
Selected
¨¨e m
=
¨¨n o
p
¨¨p q
.
¨¨q r
PersonId
¨¨r z
==
¨¨{ }
	viewModel¨¨~ ‡
.¨¨‡ ˆ
TrainerIdOld¨¨ˆ ”
}¨¨• –
)¨¨– —
.
©© 
ToList
©© 
(
©© 
)
©© 
;
©© 
	viewModel
ªª 
.
ªª 
TrainingTypesList
ªª +
=
ªª, -$
_staticDropdownService
ªª. D
.
ªªD E
GetTrainingTypes
ªªE U
(
ªªU V
)
ªªV W
.
«« 
Select
«« 
(
«« 
t
«« 
=>
«« 
new
«« "
SelectListItem
««# 1
{
««2 3
Value
««4 9
=
««: ;
t
««< =
.
««= >
Value
««> C
,
««C D
Text
««E I
=
««J K
t
««L M
.
««M N
Text
««N R
,
««R S
Selected
««T \
=
««] ^
t
««_ `
.
««` a
Value
««a f
==
««g i
	viewModel
««j s
.
««s t
TrainingTypeOld««t ƒ
}««„ …
)««… †
.
¬¬ 
ToList
¬¬ 
(
¬¬ 
)
¬¬ 
;
¬¬ 
	viewModel
­­ 
.
­­  
TrainingAnimalList
­­ ,
=
­­- .$
_staticDropdownService
­­/ E
.
­­E F
GetTrainingAnimal
­­F W
(
­­W X
)
­­X Y
.
®® 
Select
®® 
(
®® 
t
®® 
=>
®® 
new
®®  #
SelectListItem
®®$ 2
{
®®3 4
Value
®®5 :
=
®®; <
t
®®= >
.
®®> ?
Value
®®? D
,
®®D E
Text
®®F J
=
®®K L
t
®®M N
.
®®N O
Text
®®O S
,
®®S T
Selected
®®U ]
=
®®^ _
t
®®` a
.
®®a b
Value
®®b g
==
®®h j
	viewModel
®®k t
.
®®t u 
TrainingAnimalOld®®u †
}®®‡ ˆ
)®®ˆ ‰
.
¯¯ 
ToList
¯¯ 
(
¯¯ 
)
¯¯ 
;
¯¯ 
	viewModel
°° 
.
°° 
TrainingDateTime
°° *
=
°°+ ,
	viewModel
°°- 6
.
°°6 7!
TrainingDateTimeOld
°°7 J
;
°°J K
return
±± 
View
±± 
(
±± 
	viewModel
±± %
)
±±% &
;
±±& '
}
²² 
var
´´ 
editTraining
´´ 
=
´´ 
_mapper
´´ &
.
´´& '
Map
´´' *
<
´´* +
EditTrainingDto
´´+ :
>
´´: ;
(
´´; <
	viewModel
´´< E
)
´´E F
;
´´F G
try
¶¶ 
{
·· 
if
¸¸ 
(
¸¸ 
canEdit
¸¸ 
)
¸¸ 
{
¹¹ 
var
ºº 
message
ºº 
=
ºº  !
await
ºº" '
_trainingService
ºº( 8
.
ºº8 9!
UpdateTrainingAsync
ºº9 L
(
ººL M
editTraining
ººM Y
)
ººY Z
;
ººZ [
TempData
»» 
[
»» 
trainingMessage
»» ,
]
»», -
=
»». /
message
»»0 7
;
»»7 8
}
¼¼ 
}
½½ 
catch
¾¾ 
(
¾¾ 
SqlException
¾¾ 
sqlEx
¾¾  %
)
¾¾% &
{
¿¿ 
_logService
ÁÁ 
.
ÁÁ 
LogSqlException
ÁÁ +
(
ÁÁ+ ,
sqlEx
ÁÁ, 1
,
ÁÁ1 2
ControllerContext
ÁÁ3 D
.
ÁÁD E
ActionDescriptor
ÁÁE U
.
ÁÁU V

ActionName
ÁÁV `
)
ÁÁ` a
;
ÁÁa b
TempData
ÂÂ 
[
ÂÂ 
trainingMessage
ÂÂ (
]
ÂÂ( )
=
ÂÂ* +
$str
ÂÂ, E
;
ÂÂE F
}
ÃÃ 
catch
ÄÄ 
(
ÄÄ 
	Exception
ÄÄ 
ex
ÄÄ 
)
ÄÄ  
{
ÅÅ 
_logService
ÆÆ 
.
ÆÆ !
LogGeneralException
ÆÆ /
(
ÆÆ/ 0
ex
ÆÆ0 2
,
ÆÆ2 3
ControllerContext
ÆÆ4 E
.
ÆÆE F
ActionDescriptor
ÆÆF V
.
ÆÆV W

ActionName
ÆÆW a
)
ÆÆa b
;
ÆÆb c
TempData
ÇÇ 
[
ÇÇ 
trainingMessage
ÇÇ (
]
ÇÇ( )
=
ÇÇ* +
$str
ÇÇ, E
;
ÇÇE F
}
ÈÈ 
return
ÊÊ 
RedirectToAction
ÊÊ #
(
ÊÊ# $
$str
ÊÊ$ 2
,
ÊÊ2 3
new
ÊÊ4 7
{
ÊÊ8 9
selectedTraineeId
ÊÊ: K
=
ÊÊL M
	viewModel
ÊÊN W
.
ÊÊW X
TraineeIdOld
ÊÊX d
}
ÊÊe f
)
ÊÊf g
;
ÊÊg h
}
ËË 	
[
ÍÍ 	
HttpGet
ÍÍ	 
]
ÍÍ 
public
ÎÎ 
async
ÎÎ 
Task
ÎÎ 
<
ÎÎ 
IActionResult
ÎÎ '
>
ÎÎ' (
ViewTraining
ÎÎ) 5
(
ÎÎ5 6
string
ÎÎ6 <
selectedTraineeId
ÎÎ= N
=
ÎÎO P
$str
ÎÎQ S
)
ÎÎS T
{
ÏÏ 	
bool
ÐÐ 
canEdit
ÐÐ 
=
ÐÐ 
await
ÐÐ  
_userDataService
ÐÐ! 1
.
ÐÐ1 2
CanEditPage
ÐÐ2 =
(
ÐÐ= >
ControllerContext
ÐÐ> O
.
ÐÐO P
ActionDescriptor
ÐÐP `
.
ÐÐ` a

ActionName
ÐÐa k
)
ÐÐk l
;
ÐÐl m
var
ÑÑ 

allPersons
ÑÑ 
=
ÑÑ 
await
ÑÑ "
_trainingService
ÑÑ# 3
.
ÑÑ3 4
GetTraineesAsync
ÑÑ4 D
(
ÑÑD E
)
ÑÑE F
;
ÑÑF G
var
ÒÒ 

allTrainee
ÒÒ 
=
ÒÒ 
_mapper
ÒÒ $
.
ÒÒ$ %
Map
ÒÒ% (
<
ÒÒ( )
IEnumerable
ÒÒ) 4
<
ÒÒ4 5%
TraineeTrainerViewModel
ÒÒ5 L
>
ÒÒL M
>
ÒÒM N
(
ÒÒN O

allPersons
ÒÒO Y
)
ÒÒY Z
;
ÒÒZ [
var
ÔÔ 
viewSelectList
ÔÔ 
=
ÔÔ  

allTrainee
ÔÔ! +
.
ÕÕ 
Select
ÕÕ 
(
ÕÕ 
p
ÕÕ 
=>
ÕÕ 
new
ÕÕ 
SelectListItem
ÕÕ  .
{
ÖÖ 
Text
×× 
=
×× 
p
×× 
.
×× 
Person
×× "
,
××" #
Value
ØØ 
=
ØØ 
p
ØØ 
.
ØØ 
PersonID
ØØ %
.
ØØ% &
ToString
ØØ& .
(
ØØ. /
)
ØØ/ 0
,
ØØ0 1
}
ÚÚ 
)
ÚÚ 
.
ÛÛ 
ToList
ÛÛ 
(
ÛÛ 
)
ÛÛ 
;
ÛÛ 
var
ÝÝ 
model
ÝÝ 
=
ÝÝ 
new
ÝÝ #
TrainingListViewModel
ÝÝ 1
{
ÞÞ 
AllTrainees
ßß 
=
ßß 
viewSelectList
ßß ,
,
ßß, -
CanEdit
àà 
=
àà 
canEdit
àà !
,
àà! "
}
ââ 
;
ââ 
IEnumerable
ãã 
<
ãã 
TrainingViewModel
ãã )
>
ãã) *
filteredTrainings
ãã+ <
;
ãã< =
if
ää 
(
ää 
!
ää 
string
ää 
.
ää 
IsNullOrEmpty
ää %
(
ää% &
selectedTraineeId
ää& 7
)
ää7 8
&&
ää9 ;
selectedTraineeId
ää< M
!=
ääN P
$str
ääQ T
)
ääT U
{
åå 
if
ææ 
(
ææ 
selectedTraineeId
ææ %
==
ææ& (

traineeAll
ææ) 3
)
ææ3 4
{
çç 
var
èè 
allTrainings
èè $
=
èè% &
await
èè' ,
_trainingService
èè- =
.
èè= >"
GetAllTrainingsAsync
èè> R
(
èèR S
)
èèS T
;
èèT U
filteredTrainings
éé %
=
éé& '
_mapper
éé( /
.
éé/ 0
Map
éé0 3
<
éé3 4
IEnumerable
éé4 ?
<
éé? @
TrainingViewModel
éé@ Q
>
ééQ R
>
ééR S
(
ééS T
allTrainings
ééT `
)
éé` a
;
ééa b
}
êê 
else
ëë 
{
ìì 
var
íí 
trainingDtos
íí $
=
íí% &
await
íí' ,
_trainingService
íí- =
.
íí= >'
GetTrainingByTraineeAsync
íí> W
(
ííW X
selectedTraineeId
ííX i
)
ííi j
;
ííj k
filteredTrainings
îî %
=
îî& '
_mapper
îî( /
.
îî/ 0
Map
îî0 3
<
îî3 4
IEnumerable
îî4 ?
<
îî? @
TrainingViewModel
îî@ Q
>
îîQ R
>
îîR S
(
îîS T
trainingDtos
îîT `
)
îî` a
;
îîa b
}
ïï 
model
ññ 
.
ññ 
FilteredTrainings
ññ '
=
ññ( )
filteredTrainings
ññ* ;
;
ññ; <
model
òò 
.
òò 
SelectedTraineeId
òò '
=
òò( )
selectedTraineeId
òò* ;
;
òò; <
}
óó 
return
ôô 
View
ôô 
(
ôô 
model
ôô 
)
ôô 
;
ôô 
}
õõ 	
[
ùù 	
HttpGet
ùù	 
]
ùù 
public
úú 
async
úú 
Task
úú 
<
úú 
IActionResult
úú '
>
úú' (
TrainerHistory
úú) 7
(
úú7 8
int
úú8 ;
selectedTrainerId
úú< M
=
úúN O
$num
úúP Q
,
úúQ R
string
úúS Y
selectedSpecies
úúZ i
=
úúj k
$str
úúl t
)
úút u
{
ûû 	
bool
üü 
canEdit
üü 
=
üü 
await
üü  
_userDataService
üü! 1
.
üü1 2
CanEditPage
üü2 =
(
üü= >
ControllerContext
üü> O
.
üüO P
ActionDescriptor
üüP `
.
üü` a

ActionName
üüa k
)
üük l
;
üül m
if
ýý 
(
ýý 
!
ýý 

ModelState
ýý 
.
ýý 
IsValid
ýý #
)
ýý# $
{
þþ 
return
ÿÿ 
RedirectToAction
ÿÿ '
(
ÿÿ' (
nameof
ÿÿ( .
(
ÿÿ. /
TrainerHistory
ÿÿ/ =
)
ÿÿ= >
)
ÿÿ> ?
;
ÿÿ? @
}
€€ 
var
 

allPersons
 
=
 
await
 "
_trainingService
# 3
.
3 4
GetTraineesAsync
4 D
(
D E
)
E F
;
F G
var
‚‚ 
allTrainers
‚‚ 
=
‚‚ 
_mapper
‚‚ %
.
‚‚% &
Map
‚‚& )
<
‚‚) *
List
‚‚* .
<
‚‚. /%
TraineeTrainerViewModel
‚‚/ F
>
‚‚F G
>
‚‚G H
(
‚‚H I

allPersons
‚‚I S
)
‚‚S T
;
‚‚T U
var
„„ 

historyDto
„„ 
=
„„ 
await
„„ "
_trainingService
„„# 3
.
„„3 4$
GetTrainerHistoryAsync
„„4 J
(
„„J K
selectedTrainerId
„„K \
,
„„\ ]
selectedSpecies
„„^ m
)
„„m n
;
„„n o
var
‡‡ 
historyData
‡‡ 
=
‡‡ 
_mapper
‡‡ %
.
‡‡% &
Map
‡‡& )
<
‡‡) *
List
‡‡* .
<
‡‡. /"
TrainingHistoryModel
‡‡/ C
>
‡‡C D
>
‡‡D E
(
‡‡E F

historyDto
‡‡F P
)
‡‡P Q
;
‡‡Q R
var
ŠŠ 
model
ŠŠ 
=
ŠŠ 
new
ŠŠ %
TrainerHistoryViewModel
ŠŠ 3
{
‹‹ 
CanEdit
ŒŒ 
=
ŒŒ 
canEdit
ŒŒ !
,
ŒŒ! "
SelectedTrainerId
 !
=
" #
selectedTrainerId
$ 5
,
5 6
SelectedSpecies
ŽŽ 
=
ŽŽ  !
selectedSpecies
ŽŽ" 1
,
ŽŽ1 2
AllTrainers
 
=
 
allTrainers
 )
,
) *
HistoryDetails
 
=
  
historyData
! ,
,
, - 
TrainingAnimalList
‘‘ "
=
‘‘# $$
_staticDropdownService
‘‘% ;
.
‘‘; <
GetTrainingAnimal
‘‘< M
(
‘‘M N
)
‘‘N O
}
’’ 
;
’’ 
var
““ 
trainerSelectList
““ !
=
““" #
allTrainers
““$ /
.
”” 
Select
”” 
(
”” 
trainer
”” 
=>
””  "
new
””# &
SelectListItem
””' 5
{
•• 
Value
–– 
=
–– 
trainer
–– #
.
––# $
PersonID
––$ ,
.
––, -
ToString
––- 5
(
––5 6
)
––6 7
,
––7 8
Text
—— 
=
—— 
trainer
—— "
.
——" #
Person
——# )
,
——) *
Selected
˜˜ 
=
˜˜ 
trainer
˜˜ &
.
˜˜& '
PersonID
˜˜' /
==
˜˜0 2
selectedTrainerId
˜˜3 D
}
™™ 
)
™™ 
.
šš 
ToList
šš 
(
šš 
)
šš 
;
šš 
trainerSelectList
 
.
 
Insert
 $
(
$ %
$num
% &
,
& '
new
( +
SelectListItem
, :
{
žž 
Value
ŸŸ 
=
ŸŸ 
$str
ŸŸ 
,
ŸŸ 
Text
   
=
   
$str
   #
,
  # $
}
¡¡ 
)
¡¡ 
;
¡¡ 
model
££ 
.
££ 
AllTrainersList
££ !
=
££" #
trainerSelectList
££$ 5
;
££5 6
return
¤¤ 
View
¤¤ 
(
¤¤ 
model
¤¤ 
)
¤¤ 
;
¤¤ 
}
¥¥ 	
[
¨¨ 	
HttpGet
¨¨	 
]
¨¨ 
public
©© 
async
©© 
Task
©© 
<
©© 
IActionResult
©© '
>
©©' (
TrainerTrained
©©) 7
(
©©7 8
int
©©8 ;
selectedTrainerId
©©< M
=
©©N O
$num
©©P Q
)
©©Q R
{
ªª 	
bool
«« 
canEdit
«« 
=
«« 
await
««  
_userDataService
««! 1
.
««1 2
CanEditPage
««2 =
(
««= >
ControllerContext
««> O
.
««O P
ActionDescriptor
««P `
.
««` a

ActionName
««a k
)
««k l
;
««l m
if
¬¬ 
(
¬¬ 
!
¬¬ 

ModelState
¬¬ 
.
¬¬ 
IsValid
¬¬ #
)
¬¬# $
{
­­ 
return
®® 
RedirectToAction
®® '
(
®®' (
nameof
®®( .
(
®®. /
TrainerTrained
®®/ =
)
®®= >
)
®®> ?
;
®®? @
}
¯¯ 
var
°° 

allPersons
°° 
=
°° 
await
°° "
_trainingService
°°# 3
.
°°3 4
GetTraineesAsync
°°4 D
(
°°D E
)
°°E F
;
°°F G
var
±± 
allTrainers
±± 
=
±± 
_mapper
±± %
.
±±% &
Map
±±& )
<
±±) *
List
±±* .
<
±±. /!
TrainerTrainedModel
±±/ B
>
±±B C
>
±±C D
(
±±D E

allPersons
±±E O
)
±±O P
;
±±P Q
var
³³ 
trainedList
³³ 
=
³³ 
selectedTrainerId
³³ /
!=
³³0 2
$num
³³3 4
?
´´ 
await
´´ 
_trainingService
´´ (
.
´´( )$
GetTrainerTrainedAsync
´´) ?
(
´´? @
selectedTrainerId
´´@ Q
)
´´Q R
:
µµ 
new
µµ 
List
µµ 
<
µµ 
TrainerTrainedDto
µµ ,
>
µµ, -
(
µµ- .
)
µµ. /
;
µµ/ 0
var
¸¸ 
model
¸¸ 
=
¸¸ 
new
¸¸ %
TrainerTrainedViewModel
¸¸ 3
{
¹¹ 
CanEdit
ºº 
=
ºº 
canEdit
ºº !
,
ºº! "
SelectedTrainerId
»» !
=
»»" #
selectedTrainerId
»»$ 5
,
»»5 6
AllTrainers
¼¼ 
=
¼¼ 
allTrainers
¼¼ )
,
¼¼) *$
TraineeTrainingDetails
½½ &
=
½½' (
trainedList
½½) 4
.
½½4 5
ToList
½½5 ;
(
½½; <
)
½½< =
}
¾¾ 
;
¾¾ 
var
¿¿ 
trainerList
¿¿ 
=
¿¿ 
allTrainers
¿¿ )
.
ÀÀ 
Select
ÀÀ 
(
ÀÀ 
t
ÀÀ 
=>
ÀÀ 
new
ÀÀ  
SelectListItem
ÀÀ! /
{
ÁÁ 
Value
ÂÂ 
=
ÂÂ 
t
ÂÂ 
.
ÂÂ 
PersonID
ÂÂ &
.
ÂÂ& '
ToString
ÂÂ' /
(
ÂÂ/ 0
)
ÂÂ0 1
,
ÂÂ1 2
Text
ÃÃ 
=
ÃÃ 
t
ÃÃ 
.
ÃÃ 
Person
ÃÃ #
,
ÃÃ# $
Selected
ÄÄ 
=
ÄÄ 
t
ÄÄ  
.
ÄÄ  !
PersonID
ÄÄ! )
==
ÄÄ* ,
selectedTrainerId
ÄÄ- >
}
ÅÅ 
)
ÅÅ 
.
ÅÅ 
ToList
ÅÅ 
(
ÅÅ 
)
ÅÅ 
;
ÅÅ 
trainerList
ÇÇ 
.
ÇÇ 
Insert
ÇÇ 
(
ÇÇ 
$num
ÇÇ  
,
ÇÇ  !
new
ÇÇ" %
SelectListItem
ÇÇ& 4
{
ÈÈ 
Value
ÉÉ 
=
ÉÉ 
$str
ÉÉ 
,
ÉÉ 
Text
ÊÊ 
=
ÊÊ 
$str
ÊÊ '
,
ÊÊ' (
Selected
ËË 
=
ËË 
selectedTrainerId
ËË ,
==
ËË- /
$num
ËË0 1
}
ÌÌ 
)
ÌÌ 
;
ÌÌ 
model
ÎÎ 
.
ÎÎ 
TrainerSelectList
ÎÎ #
=
ÎÎ$ %
trainerList
ÎÎ& 1
;
ÎÎ1 2
return
ÐÐ 
View
ÐÐ 
(
ÐÐ 
model
ÐÐ 
)
ÐÐ 
;
ÐÐ 
}
ÑÑ 	
[
ÓÓ 	
HttpPost
ÓÓ	 
]
ÓÓ 
[
ÔÔ 	&
ValidateAntiForgeryToken
ÔÔ	 !
]
ÔÔ! "
public
ÕÕ 
async
ÕÕ 
Task
ÕÕ 
<
ÕÕ 
IActionResult
ÕÕ '
>
ÕÕ' (
DeleteTraining
ÕÕ) 7
(
ÕÕ7 8
int
ÕÕ8 ;
	traineeId
ÕÕ< E
,
ÕÕE F
string
ÕÕG M
species
ÕÕN U
,
ÕÕU V
DateTime
ÕÕW _
dateTrained
ÕÕ` k
)
ÕÕk l
{
ÖÖ 	
bool
×× 
canEdit
×× 
=
×× 
await
××  
_userDataService
××! 1
.
××1 2
CanEditPage
××2 =
(
××= >
ControllerContext
××> O
.
××O P
ActionDescriptor
××P `
.
××` a

ActionName
××a k
)
××k l
;
××l m
if
ØØ 
(
ØØ 
!
ØØ 

ModelState
ØØ 
.
ØØ 
IsValid
ØØ #
)
ØØ# $
{
ÙÙ 
TempData
ÚÚ 
[
ÚÚ 
trainingMessage
ÚÚ (
]
ÚÚ( )
=
ÚÚ* +
$str
ÚÚ, Q
;
ÚÚQ R
return
ÛÛ 
RedirectToAction
ÛÛ '
(
ÛÛ' (
nameof
ÛÛ( .
(
ÛÛ. /
ViewTraining
ÛÛ/ ;
)
ÛÛ; <
,
ÛÛ< =
new
ÛÛ> A
{
ÛÛB C
selectedTraineeId
ÛÛD U
=
ÛÛV W
	traineeId
ÛÛX a
}
ÛÛb c
)
ÛÛc d
;
ÛÛd e
}
ÜÜ 
try
ÝÝ 
{
ÞÞ 
if
ßß 
(
ßß 
canEdit
ßß 
)
ßß 
{
àà 
var
áá 
message
áá 
=
áá  !
await
áá" '
_trainingService
áá( 8
.
áá8 9!
DeleteTrainingAsync
áá9 L
(
ááL M
	traineeId
ááM V
,
ááV W
species
ááX _
,
áá_ `
dateTrained
ááa l
)
áál m
;
áám n
TempData
ââ 
[
ââ 
trainingMessage
ââ ,
]
ââ, -
=
ââ. /
message
ââ0 7
;
ââ7 8
}
ãã 
}
ää 
catch
åå 
(
åå 
SqlException
åå 
sqlEx
åå  %
)
åå% &
{
ææ 
_logService
èè 
.
èè 
LogSqlException
èè +
(
èè+ ,
sqlEx
èè, 1
,
èè1 2
ControllerContext
èè3 D
.
èèD E
ActionDescriptor
èèE U
.
èèU V

ActionName
èèV `
)
èè` a
;
èèa b
TempData
éé 
[
éé 
trainingMessage
éé (
]
éé( )
=
éé* +
$str
éé, ;
;
éé; <
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
ex
ëë 
)
ëë  
{
ìì 
_logService
íí 
.
íí !
LogGeneralException
íí /
(
íí/ 0
ex
íí0 2
,
íí2 3
ControllerContext
íí4 E
.
ííE F
ActionDescriptor
ííF V
.
ííV W

ActionName
ííW a
)
íía b
;
ííb c
TempData
îî 
[
îî 
trainingMessage
îî (
]
îî( )
=
îî* +
$str
îî, ;
;
îî; <
}
ïï 
return
ññ 
RedirectToAction
ññ #
(
ññ# $
nameof
ññ$ *
(
ññ* +
ViewTraining
ññ+ 7
)
ññ7 8
,
ññ8 9
new
ññ: =
{
ññ> ?
selectedTraineeId
ññ@ Q
=
ññR S
	traineeId
ññT ]
}
ññ^ _
)
ññ_ `
;
ññ` a
}
òò 	
}
ôô 
}õõ ‘°
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\SiteController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
SiteController 
:  !

Controller" ,
{ 
private 
readonly 
ISiteService %
_siteService& 2
;2 3
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
ILogService $
_logService% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 
const 
string 
siteAll $
=% &
$str' ,
;, -
private 
const 
string 
status #
=$ %
$str& 3
;3 4
private 
const 
string 
siteMessage (
=) *
$str+ 8
;8 9
public 
SiteController 
( 
ISiteService *
siteService+ 6
,6 7
IMapper8 ?
mapper@ F
,F G
IUserDataServiceH X
userDataServiceY h
,h i
ILogServicej u

logService	v €
)
€ 
{ 	
_siteService 
= 
siteService &
;& '
_mapper 
= 
mapper 
; 
_userDataService   
=   
userDataService   .
;  . /
_logService!! 
=!! 

logService!! $
;!!$ %
}## 	
[%% 	
HttpGet%%	 
]%% 
public&& 
async&& 
Task&& 
<&& 
IActionResult&& '
>&&' (
ViewSite&&) 1
(&&1 2
string&&2 8
selectedSite&&9 E
=&&F G
siteAll&&H O
)&&O P
{'' 	
bool(( 
canEdit(( 
=(( 
await((  
_userDataService((! 1
.((1 2
CanEditPage((2 =
(((= >
ControllerContext((> O
.((O P
ActionDescriptor((P `
.((` a

ActionName((a k
)((k l
;((l m
var++ 
allSitesDto++ 
=++ 
await++ #
_siteService++$ 0
.++0 1
GetAllSitesAsync++1 A
(++A B
$str++B G
)++G H
;++H I
var,, 
allSites,, 
=,, 
_mapper,, "
.,," #
Map,,# &
<,,& '
IEnumerable,,' 2
<,,2 3
SiteViewModel,,3 @
>,,@ A
>,,A B
(,,B C
allSitesDto,,C N
),,N O
;,,O P
var.. 
siteSelectList.. 
=..  
allSites..! )
.// 
Select// 
(// 
site// 
=>// 
new//  #
SelectListItem//$ 2
{00 
Value11 
=11 
site11  
.11  !
PlantNo11! (
,11( )
Text22 
=22 
site22 
.22  
Name22  $
,22$ %
}33 
)33 
.44 
ToList44 
(44 
)44 
;44 
IEnumerable66 
<66 
SiteViewModel66 %
>66% &
filteredSites66' 4
=665 6
selectedSite667 C
==66D F
$str66G L
?77 
allSites77 
:88 
allSites88 
.88 
Where88  
(88  !
s88! "
=>88# %
s88& '
.88' (
PlantNo88( /
==880 2
selectedSite883 ?
)88? @
;88@ A
var:: 
model:: 
=:: 
new:: 
SiteListViewModel:: -
{;; 
AllSites<< 
=<< 
siteSelectList<< )
,<<) *
FilteredSites== 
=== 
filteredSites==  -
,==- .
SelectedSite>> 
=>> 
selectedSite>> +
,>>+ ,
CanEdit?? 
=?? 
canEdit?? !
}@@ 
;@@ 
returnBB 
ViewBB 
(BB 
modelBB 
)BB 
;BB 
}CC 	
publicFF 
asyncFF 
TaskFF 
<FF 
IActionResultFF '
>FF' (
SiteTraineeFF) 4
(FF4 5
stringFF5 ;
?FF; <
selectedSiteFF= I
=FFJ K
nullFFL P
)FFP Q
{GG 	
boolHH 
canEditHH 
=HH 
awaitHH  
_userDataServiceHH! 1
.HH1 2
CanEditPageHH2 =
(HH= >
ControllerContextHH> O
.HHO P
ActionDescriptorHHP `
.HH` a

ActionNameHHa k
)HHk l
;HHl m
varJJ 
allSitesDtoJJ 
=JJ 
awaitJJ #
_siteServiceJJ$ 0
.JJ0 1
GetAllSitesAsyncJJ1 A
(JJA B
siteAllJJB I
)JJI J
;JJJ K
varKK 
allSitesKK 
=KK 
_mapperKK "
.KK" #
MapKK# &
<KK& '
IEnumerableKK' 2
<KK2 3
SiteViewModelKK3 @
>KK@ A
>KKA B
(KKB C
allSitesDtoKKC N
)KKN O
;KKO P
varMM 
siteSelectListMM 
=MM  
allSitesMM! )
.NN 
SelectNN 
(NN 
siteNN 
=>NN 
newNN 
SelectListItemNN  .
{OO 
ValuePP 
=PP 
sitePP 
.PP 
PlantNoPP $
,PP$ %
TextQQ 
=QQ 
siteQQ 
.QQ 
NameQQ  
,QQ  !
SelectedRR 
=RR 
(RR 
siteRR  
.RR  !
PlantNoRR! (
==RR) +
selectedSiteRR, 8
)RR8 9
}SS 
)SS 
.TT 
ToListTT 
(TT 
)TT 
;TT 
varVV 
modelVV 
=VV 
newVV $
SiteTraineeListViewModelVV 4
{WW 
AllSitesYY 
=YY 
siteSelectListYY )
,YY) *
CanEditZZ 
=ZZ 
canEditZZ !
}[[ 
;[[ 
if\\ 
(\\ 
selectedSite\\ 
!=\\ 
null\\  $
)\\$ %
{]] 
IEnumerable__ 
<__  
SiteTraineeViewModel__ 0
>__0 1
filteredTrainees__2 B
;__B C
varaa 
traineeDtosaa 
=aa  !
awaitaa" '
_siteServiceaa( 4
.aa4 5 
GetSiteTraineesAsyncaa5 I
(aaI J
selectedSiteaaJ V
)aaV W
;aaW X
filteredTraineesbb  
=bb! "
_mapperbb# *
.bb* +
Mapbb+ .
<bb. /
IEnumerablebb/ :
<bb: ; 
SiteTraineeViewModelbb; O
>bbO P
>bbP Q
(bbQ R
traineeDtosbbR ]
)bb] ^
;bb^ _
modeldd 
.dd 
FilteredTraineesdd &
=dd' (
filteredTraineesdd) 9
;dd9 :
modelee 
.ee 
SelectedSiteee "
=ee# $
selectedSiteee% 1
;ee1 2
}hh 
returnjj 
Viewjj 
(jj 
modeljj 
)jj 
;jj 
}kk 	
[oo 	
HttpGetoo	 
]oo 
publicpp 
asyncpp 
Taskpp 
<pp 
IActionResultpp '
>pp' (
AddSitepp) 0
(pp0 1
)pp1 2
{qq 	
boolrr 
canEditrr 
=rr 
awaitrr  
_userDataServicerr! 1
.rr1 2
CanEditPagerr2 =
(rr= >
ControllerContextrr> O
.rrO P
ActionDescriptorrrP `
.rr` a

ActionNamerra k
)rrk l
;rrl m
SiteViewModelss 
modelss 
=ss  !
newss" %
SiteViewModelss& 3
{tt 
PlantNouu 
=uu 
stringuu  
.uu  !
Emptyuu! &
,uu& '
Namevv 
=vv 
stringvv 
.vv 
Emptyvv #
,vv# $
CanEditww 
=ww 
canEditww !
,ww! "
}xx 
;xx 
returnyy 
Viewyy 
(yy 
modelyy 
)yy 
;yy 
}zz 	
[|| 	
HttpPost||	 
]|| 
[}} 	$
ValidateAntiForgeryToken}}	 !
]}}! "
public~~ 
async~~ 
Task~~ 
<~~ 
IActionResult~~ '
>~~' (
AddSite~~) 0
(~~0 1
SiteViewModel~~1 >
siteViewModel~~? L
)~~L M
{ 	
bool
€€ 
canEdit
€€ 
=
€€ 
await
€€  
_userDataService
€€! 1
.
€€1 2
CanEditPage
€€2 =
(
€€= >
ControllerContext
€€> O
.
€€O P
ActionDescriptor
€€P `
.
€€` a

ActionName
€€a k
)
€€k l
;
€€l m
siteViewModel
 
.
 
CanEdit
 !
=
" #
canEdit
$ +
;
+ ,
if
‚‚ 
(
‚‚ 

ModelState
‚‚ 
.
‚‚ 
IsValid
‚‚ "
)
‚‚" #
{
ƒƒ 
try
„„ 
{
…… 
string
†† 
userName
†† #
=
††$ %
_userDataService
††& 6
.
††6 7
GetUsername
††7 B
(
††B C
)
††C D
??
††E G
$str
††H J
;
††J K
if
‡‡ 
(
‡‡ 
canEdit
‡‡ 
)
‡‡  
{
ˆˆ 
var
‰‰ 
site
‰‰  
=
‰‰! "
_mapper
‰‰# *
.
‰‰* +
Map
‰‰+ .
<
‰‰. /
SiteDto
‰‰/ 6
>
‰‰6 7
(
‰‰7 8
siteViewModel
‰‰8 E
)
‰‰E F
;
‰‰F G
var
ŠŠ 
message
ŠŠ #
=
ŠŠ$ %
await
ŠŠ& +
_siteService
ŠŠ, 8
.
ŠŠ8 9
AddSiteAsync
ŠŠ9 E
(
ŠŠE F
site
ŠŠF J
,
ŠŠJ K
userName
ŠŠL T
)
ŠŠT U
;
ŠŠU V
TempData
ŒŒ  
[
ŒŒ  !
siteMessage
ŒŒ! ,
]
ŒŒ, -
=
ŒŒ. /
message
ŒŒ0 7
;
ŒŒ7 8
}
 
}
ŽŽ 
catch
 
(
 
SqlException
 #
sqlEx
$ )
)
) *
{
 
_logService
‘‘ 
.
‘‘  
LogSqlException
‘‘  /
(
‘‘/ 0
sqlEx
‘‘0 5
,
‘‘5 6
ControllerContext
‘‘7 H
.
‘‘H I
ActionDescriptor
‘‘I Y
.
‘‘Y Z

ActionName
‘‘Z d
)
‘‘d e
;
‘‘e f
TempData
’’ 
[
’’ 
siteMessage
’’ (
]
’’( )
=
’’* +
status
’’, 2
;
’’2 3
}
““ 
catch
”” 
(
”” 
	Exception
””  
ex
””! #
)
””# $
{
•• 
_logService
–– 
.
––  !
LogGeneralException
––  3
(
––3 4
ex
––4 6
,
––6 7
ControllerContext
––8 I
.
––I J
ActionDescriptor
––J Z
.
––Z [

ActionName
––[ e
)
––e f
;
––f g
TempData
—— 
[
—— 
siteMessage
—— (
]
——( )
=
——* +
status
——, 2
;
——2 3
}
˜˜ 
return
›› 
RedirectToAction
›› '
(
››' (
nameof
››( .
(
››. /
AddSite
››/ 6
)
››6 7
)
››7 8
;
››8 9
}
œœ 
return
žž 
View
žž 
(
žž 
siteViewModel
žž %
)
žž% &
;
žž& '
}
ŸŸ 	
[
¡¡ 	
HttpPost
¡¡	 
]
¡¡ 
public
¢¢ 
async
¢¢ 
Task
¢¢ 
<
¢¢ 
IActionResult
¢¢ '
>
¢¢' (
DeleteTrainee
¢¢) 6
(
¢¢6 7
int
¢¢7 :
personId
¢¢; C
,
¢¢C D
string
¢¢E K
selectedSite
¢¢L X
)
¢¢X Y
{
££ 	
bool
¤¤ 
canEdit
¤¤ 
=
¤¤ 
await
¤¤  
_userDataService
¤¤! 1
.
¤¤1 2
CanEditPage
¤¤2 =
(
¤¤= >
ControllerContext
¤¤> O
.
¤¤O P
ActionDescriptor
¤¤P `
.
¤¤` a

ActionName
¤¤a k
)
¤¤k l
;
¤¤l m
if
¥¥ 
(
¥¥ 
!
¥¥ 

ModelState
¥¥ 
.
¥¥ 
IsValid
¥¥ #
)
¥¥# $
{
¦¦ 
TempData
§§ 
[
§§ 
siteMessage
§§ $
]
§§$ %
=
§§& '
$str
§§( 9
;
§§9 :
return
¨¨ 
RedirectToAction
¨¨ '
(
¨¨' (
$str
¨¨( 5
,
¨¨5 6
new
¨¨7 :
{
¨¨; <
selectedSite
¨¨= I
}
¨¨J K
)
¨¨K L
;
¨¨L M
}
©© 
try
ªª 
{
«« 
if
¬¬ 
(
¬¬ 
canEdit
¬¬ 
)
¬¬ 
{
­­ 
var
®® 
message
®® 
=
®®  !
await
®®" '
_siteService
®®( 4
.
®®4 5 
DeleteTraineeAsync
®®5 G
(
®®G H
personId
®®H P
)
®®P Q
;
®®Q R
TempData
¯¯ 
[
¯¯ 
siteMessage
¯¯ (
]
¯¯( )
=
¯¯* +
message
¯¯, 3
;
¯¯3 4
}
°° 
}
±± 
catch
²² 
(
²² 
SqlException
²² 
sqlEx
²²  %
)
²²% &
{
³³ 
_logService
´´ 
.
´´ 
LogSqlException
´´ +
(
´´+ ,
sqlEx
´´, 1
,
´´1 2
ControllerContext
´´3 D
.
´´D E
ActionDescriptor
´´E U
.
´´U V

ActionName
´´V `
)
´´` a
;
´´a b
TempData
µµ 
[
µµ 
siteMessage
µµ $
]
µµ$ %
=
µµ& '
status
µµ( .
;
µµ. /
}
¶¶ 
catch
·· 
(
·· 
	Exception
·· 
ex
·· 
)
··  
{
¸¸ 
_logService
¹¹ 
.
¹¹ !
LogGeneralException
¹¹ /
(
¹¹/ 0
ex
¹¹0 2
,
¹¹2 3
ControllerContext
¹¹4 E
.
¹¹E F
ActionDescriptor
¹¹F V
.
¹¹V W

ActionName
¹¹W a
)
¹¹a b
;
¹¹b c
TempData
ºº 
[
ºº 
siteMessage
ºº $
]
ºº$ %
=
ºº& '
status
ºº( .
;
ºº. /
}
»» 
return
½½ 
RedirectToAction
½½ #
(
½½# $
$str
½½$ 1
,
½½1 2
new
½½3 6
{
½½7 8
selectedSite
½½9 E
}
½½F G
)
½½G H
;
½½H I
}
¾¾ 	
[
¿¿ 	
HttpGet
¿¿	 
]
¿¿ 
public
ÀÀ 
async
ÀÀ 
Task
ÀÀ 
<
ÀÀ 
IActionResult
ÀÀ '
>
ÀÀ' (
EditSite
ÀÀ) 1
(
ÀÀ1 2
string
ÀÀ2 8
plantNo
ÀÀ9 @
)
ÀÀ@ A
{
ÁÁ 	
bool
ÂÂ 
canEdit
ÂÂ 
=
ÂÂ 
await
ÂÂ  
_userDataService
ÂÂ! 1
.
ÂÂ1 2
CanEditPage
ÂÂ2 =
(
ÂÂ= >
ControllerContext
ÂÂ> O
.
ÂÂO P
ActionDescriptor
ÂÂP `
.
ÂÂ` a

ActionName
ÂÂa k
)
ÂÂk l
;
ÂÂl m
if
ÃÃ 
(
ÃÃ 
string
ÃÃ 
.
ÃÃ 
IsNullOrEmpty
ÃÃ $
(
ÃÃ$ %
plantNo
ÃÃ% ,
)
ÃÃ, -
)
ÃÃ- .
{
ÄÄ 
return
ÅÅ 
RedirectToAction
ÅÅ '
(
ÅÅ' (
nameof
ÅÅ( .
(
ÅÅ. /
ViewSite
ÅÅ/ 7
)
ÅÅ7 8
)
ÅÅ8 9
;
ÅÅ9 :
}
ÆÆ 
var
ÈÈ 
siteDtos
ÈÈ 
=
ÈÈ 
await
ÈÈ  
_siteService
ÈÈ! -
.
ÈÈ- .
GetAllSitesAsync
ÈÈ. >
(
ÈÈ> ?
plantNo
ÈÈ? F
)
ÈÈF G
;
ÈÈG H
var
ÉÉ 
siteDto
ÉÉ 
=
ÉÉ 
siteDtos
ÉÉ "
.
ÉÉ" #
FirstOrDefault
ÉÉ# 1
(
ÉÉ1 2
)
ÉÉ2 3
;
ÉÉ3 4
if
ËË 
(
ËË 
siteDto
ËË 
==
ËË 
null
ËË 
)
ËË  
{
ÌÌ 
TempData
ÍÍ 
[
ÍÍ 
siteMessage
ÍÍ $
]
ÍÍ$ %
=
ÍÍ& '
$str
ÍÍ( L
;
ÍÍL M
return
ÎÎ 
RedirectToAction
ÎÎ '
(
ÎÎ' (
nameof
ÎÎ( .
(
ÎÎ. /
ViewSite
ÎÎ/ 7
)
ÎÎ7 8
)
ÎÎ8 9
;
ÎÎ9 :
}
ÏÏ 
var
ÑÑ 
	viewModel
ÑÑ 
=
ÑÑ 
new
ÑÑ 
EditSiteViewModel
ÑÑ  1
{
ÒÒ 
CanEdit
ÓÓ 
=
ÓÓ 
canEdit
ÓÓ !
,
ÓÓ! "
PlantNo
ÔÔ 
=
ÔÔ 
siteDto
ÔÔ !
.
ÔÔ! "
PlantNo
ÔÔ" )
,
ÔÔ) *
Name
ÕÕ 
=
ÕÕ 
siteDto
ÕÕ 
.
ÕÕ 
Name
ÕÕ #
,
ÕÕ# $
AddressLine1
ÖÖ 
=
ÖÖ 
siteDto
ÖÖ &
.
ÖÖ& '
AddressLine1
ÖÖ' 3
,
ÖÖ3 4
AddressLine2
×× 
=
×× 
siteDto
×× &
.
××& '
AddressLine2
××' 3
,
××3 4
AddressTown
ØØ 
=
ØØ 
siteDto
ØØ %
.
ØØ% &
AddressTown
ØØ& 1
,
ØØ1 2
AddressCounty
ÙÙ 
=
ÙÙ 
siteDto
ÙÙ  '
.
ÙÙ' (
AddressCounty
ÙÙ( 5
,
ÙÙ5 6
AddressPostCode
ÚÚ 
=
ÚÚ  !
siteDto
ÚÚ" )
.
ÚÚ) *
AddressPostCode
ÚÚ* 9
,
ÚÚ9 :
	Telephone
ÛÛ 
=
ÛÛ 
siteDto
ÛÛ #
.
ÛÛ# $
	Telephone
ÛÛ$ -
,
ÛÛ- .
Fax
ÜÜ 
=
ÜÜ 
siteDto
ÜÜ 
.
ÜÜ 
Fax
ÜÜ !
,
ÜÜ! "
IsAhvla
ÝÝ 
=
ÝÝ 
siteDto
ÝÝ !
.
ÝÝ! "
Ahvla
ÝÝ" '
?
ÝÝ' (
.
ÝÝ( )
Trim
ÝÝ) -
(
ÝÝ- .
)
ÝÝ. /
.
ÝÝ/ 0
Equals
ÝÝ0 6
(
ÝÝ6 7
$str
ÝÝ7 >
)
ÝÝ> ?
??
ÝÝ@ B
false
ÝÝC H
,
ÝÝH I
}
ßß 
;
ßß 
return
ãã 
View
ãã 
(
ãã 
	viewModel
ãã !
)
ãã! "
;
ãã" #
}
ää 	
[
ææ 	
HttpPost
ææ	 
]
ææ 
[
çç 	&
ValidateAntiForgeryToken
çç	 !
]
çç! "
public
èè 
async
èè 
Task
èè 
<
èè 
IActionResult
èè '
>
èè' (
EditSite
èè) 1
(
èè1 2
EditSiteViewModel
èè2 C
editSiteViewModel
èèD U
)
èèU V
{
éé 	
bool
êê 
canEdit
êê 
=
êê 
await
êê  
_userDataService
êê! 1
.
êê1 2
CanEditPage
êê2 =
(
êê= >
ControllerContext
êê> O
.
êêO P
ActionDescriptor
êêP `
.
êê` a

ActionName
êêa k
)
êêk l
;
êêl m
editSiteViewModel
ëë 
.
ëë 
CanEdit
ëë %
=
ëë& '
canEdit
ëë( /
;
ëë/ 0
if
ìì 
(
ìì 
!
ìì 

ModelState
ìì 
.
ìì 
IsValid
ìì #
)
ìì# $
{
íí 
editSiteViewModel
îî !
.
îî! "
CanEdit
îî" )
=
îî* +
canEdit
îî, 3
;
îî3 4
return
ïï 
View
ïï 
(
ïï 
editSiteViewModel
ïï -
)
ïï- .
;
ïï. /
}
ðð 
try
òò 
{
óó 
var
ôô 
siteInputDto
ôô  
=
ôô! "
_mapper
ôô# *
.
ôô* +
Map
ôô+ .
<
ôô. /
SiteInputDto
ôô/ ;
>
ôô; <
(
ôô< =
editSiteViewModel
ôô= N
)
ôôN O
;
ôôO P
var
õõ 
message
õõ 
=
õõ 
await
õõ #
_siteService
õõ$ 0
.
õõ0 1
UpdateSiteAsync
õõ1 @
(
õõ@ A
siteInputDto
õõA M
)
õõM N
;
õõN O
TempData
öö 
[
öö 
siteMessage
öö $
]
öö$ %
=
öö& '
message
öö( /
;
öö/ 0
}
øø 
catch
ùù 
(
ùù 
SqlException
ùù 
sqlEx
ùù  %
)
ùù% &
{
úú 
_logService
ûû 
.
ûû 
LogSqlException
ûû +
(
ûû+ ,
sqlEx
ûû, 1
,
ûû1 2
ControllerContext
ûû3 D
.
ûûD E
ActionDescriptor
ûûE U
.
ûûU V

ActionName
ûûV `
)
ûû` a
;
ûûa b
TempData
üü 
[
üü 
siteMessage
üü $
]
üü$ %
=
üü& '
status
üü( .
;
üü. /
}
ýý 
catch
þþ 
(
þþ 
	Exception
þþ 
ex
þþ 
)
þþ  
{
ÿÿ 
_logService
€€ 
.
€€ !
LogGeneralException
€€ /
(
€€/ 0
ex
€€0 2
,
€€2 3
ControllerContext
€€4 E
.
€€E F
ActionDescriptor
€€F V
.
€€V W

ActionName
€€W a
)
€€a b
;
€€b c
TempData
 
[
 
siteMessage
 $
]
$ %
=
& '
status
( .
;
. /
}
‚‚ 
return
„„ 
View
„„ 
(
„„ 
editSiteViewModel
„„ )
)
„„) *
;
„„* +
}
…… 	
}
†† 
}‡‡ é#
PD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\ReportController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{		 
[

 
	Authorize

 
]

 
public 

class 
ReportController !
:" #

Controller$ .
{ 
private 
readonly 
IReportService '
_reportService( 6
;6 7
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
ILogService $
_logService% 0
;0 1
public 
ReportController 
(  
IReportService  .
reportService/ <
,< =
IUserDataService= M
userDataServiceN ]
,] ^
ILogService^ i

logServicej t
)t u
{ 	
_reportService 
= 
reportService *
;* +
_userDataService 
= 
userDataService .
;. /
_logService 
= 

logService $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Report) /
(/ 0
)0 1
{ 	
bool 
canEdit 
= 
await  
_userDataService! 1
.1 2
CanEditPage2 =
(= >
ControllerContext> O
.O P
ActionDescriptorP `
.` a

ActionNamea k
)k l
;l m
var 
	viewModel 
= 
new 
ReportViewModel  /
{ 
ReportTitle 
= 
$str '
,' (
CanEdit   
=   
canEdit   !
}!! 
;!! 
return## 
View## 
(## 
	viewModel## !
)##! "
;##" #
}$$ 	
[&& 	
HttpPost&&	 
]&& 
public'' 
async'' 
Task'' 
<'' 
IActionResult'' '
>''' (
GenerateExcel'') 6
(''6 7
)''7 8
{(( 	
bool)) 
canEdit)) 
=)) 
await))  
_userDataService))! 1
.))1 2
CanEditPage))2 =
())= >
ControllerContext))> O
.))O P
ActionDescriptor))P `
.))` a

ActionName))a k
)))k l
;))l m
try++ 
{,, 
if-- 
(-- 
canEdit-- 
)-- 
{.. 
var// 
(// 
fileContent// $
,//$ %
fileName//& .
)//. /
=//0 1
await//2 7
_reportService//8 F
.//F G$
GenerateExcelReportAsync//G _
(//_ `
)//` a
;//a b
return00 
File00 
(00  
fileContent00  +
,00+ ,
$str00- p
,00p q
fileName00r z
)00z {
;00{ |
}11 
}33 
catch44 
(44 
SqlException44 
sqlEx44  %
)44% &
{55 
_logService66 
.66 
LogSqlException66 +
(66+ ,
sqlEx66, 1
,661 2
ControllerContext663 D
.66D E
ActionDescriptor66E U
.66U V

ActionName66V `
)66` a
;66a b
TempData77 
[77 
$str77 (
]77( )
=77* +
$str77, ]
;77] ^
}88 
catch99 
(99 
	Exception99 
ex99 
)99  
{:: 
_logService;; 
.;; 
LogGeneralException;; /
(;;/ 0
ex;;0 2
,;;2 3
ControllerContext;;4 E
.;;E F
ActionDescriptor;;F V
.;;V W

ActionName;;W a
);;a b
;;;b c
TempData<< 
[<< 
$str<< (
]<<( )
=<<* +
$str<<, G
;<<G H
}== 
return?? 
RedirectToAction?? #
(??# $
nameof??$ *
(??* +
Report??+ 1
)??1 2
)??2 3
;??3 4
}@@ 	
}AA 
}BB ž
QD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\PersonsController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
PersonsController "
:# $

Controller% /
{ 
private 
readonly 
IPersonsService (
_personService) 7
;7 8
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
ILogService $
_logService% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
private 
const 
string 
siteAll $
=% &
$str' ,
;, -
private 
const 
string 
personMessage *
=+ ,
$str- <
;< =
public 
PersonsController  
(  !
IPersonsService! 0
personService1 >
,> ?
IMapper@ G
mapperH N
,N O
IUserDataServiceP `
userDataServicea p
,p q
ILogServicer }

logService	~ ˆ
)
ˆ ‰
{ 	
_personService 
= 
personService *
;* +
_mapper 
= 
mapper 
; 
_userDataService 
= 
userDataService .
;. /
_logService 
= 

logService $
;$ %
} 	
[ 	
HttpGet	 
] 
public   
async   
Task   
<   
IActionResult   '
>  ' (

ViewPerson  ) 3
(  3 4
int  4 7
selectedPerson  8 F
=  G H
$num  I J
)  J K
{!! 	
bool"" 
canEdit"" 
="" 
await""  
_userDataService""! 1
.""1 2
CanEditPage""2 =
(""= >
ControllerContext""> O
.""O P
ActionDescriptor""P `
.""` a

ActionName""a k
)""k l
;""l m
if## 
(## 
!## 

ModelState## 
.## 
IsValid## #
)### $
{$$ 
return%% 
RedirectToAction%% '
(%%' (
nameof%%( .
(%%. /

ViewPerson%%/ 9
)%%9 :
)%%: ;
;%%; <
}&& 
var(( 
dropdownDto(( 
=(( 
await(( #
_personService(($ 2
.((2 3&
GetPersonsForDropdownAsync((3 M
(((M N
)((N O
;((O P
var)) 
personSelectedList)) "
=))# $
dropdownDto))% 0
.** 
Select** 
(** 
persons** 
=>** !
new**" %
SelectListItem**& 4
{++ 
Value,, 
=,, 
persons,, "
.,," #
PersonID,,# +
.,,+ ,
ToString,,, 4
(,,4 5
),,5 6
,,,6 7
Text-- 
=-- 
persons-- !
.--! "
Person--" (
,--( )
}.. 
).. 
.// 
ToList// 
(// 
)// 
;// 
var11 
allPersonDto11 
=11 
await11 $
_personService11% 3
.113 4#
GetAllPersonByNameAsync114 K
(11K L
selectedPerson11L Z
)11Z [
;11[ \
var22 
	allPerson22 
=22 
_mapper22 #
.22# $
Map22$ '
<22' (
IEnumerable22( 3
<223 4
PersonViewModel224 C
>22C D
>22D E
(22E F
allPersonDto22F R
)22R S
;22S T
var55 
model55 
=55 
new55 
PersonListViewModel55 /
{66 
	AllPerson77 
=77 
personSelectedList77 .
,77. /
FilteredPerson88 
=88  
	allPerson88! *
,88* +
SelectedPerson99 
=99  
selectedPerson99! /
,99/ 0
CanEdit:: 
=:: 
canEdit:: !
};; 
;;; 
return== 
View== 
(== 
model== 
)== 
;== 
}>> 	
[?? 	
HttpPost??	 
]?? 
public@@ 
async@@ 
Task@@ 
<@@ 
IActionResult@@ '
>@@' (
DeletePerson@@) 5
(@@5 6
int@@6 9
personId@@: B
)@@B C
{AA 	
boolBB 
canEditBB 
=BB 
awaitBB  
_userDataServiceBB! 1
.BB1 2
CanEditPageBB2 =
(BB= >
ControllerContextBB> O
.BBO P
ActionDescriptorBBP `
.BB` a

ActionNameBBa k
)BBk l
;BBl m
stringCC 
failmessageCC 
=CC  
$strCC! 0
;CC0 1
ifDD 
(DD 
!DD 

ModelStateDD 
.DD 
IsValidDD #
)DD# $
{EE 
returnFF 
RedirectToActionFF '
(FF' (
nameofFF( .
(FF. /

ViewPersonFF/ 9
)FF9 :
)FF: ;
;FF; <
}GG 
tryII 
{JJ 
ifKK 
(KK 
canEditKK 
)KK 
{LL 
varMM 
messageMM 
=MM  !
awaitMM" '
_personServiceMM( 6
.MM6 7
DeletePersonAsyncMM7 H
(MMH I
personIdMMI Q
)MMQ R
;MMR S
TempDataNN 
[NN 
personMessageNN *
]NN* +
=NN, -
messageNN. 5
;NN5 6
}OO 
}PP 
catchQQ 
(QQ 
SqlExceptionQQ 
sqlExQQ  %
)QQ% &
{RR 
_logServiceSS 
.SS 
LogSqlExceptionSS +
(SS+ ,
sqlExSS, 1
,SS1 2
ControllerContextSS3 D
.SSD E
ActionDescriptorSSE U
.SSU V

ActionNameSSV `
)SS` a
;SSa b
TempDataTT 
[TT 
personMessageTT &
]TT& '
=TT( )
failmessageTT* 5
;TT5 6
}UU 
catchVV 
(VV 
	ExceptionVV 
exVV 
)VV  
{WW 
_logServiceXX 
.XX 
LogGeneralExceptionXX /
(XX/ 0
exXX0 2
,XX2 3
ControllerContextXX4 E
.XXE F
ActionDescriptorXXF V
.XXV W

ActionNameXXW a
)XXa b
;XXb c
TempDataYY 
[YY 
personMessageYY &
]YY& '
=YY( )
failmessageYY* 5
;YY5 6
}ZZ 
return\\ 
RedirectToAction\\ #
(\\# $
$str\\$ 0
)\\0 1
;\\1 2
}]] 	
[^^ 	
HttpGet^^	 
]^^ 
public__ 
async__ 
Task__ 
<__ 
IActionResult__ '
>__' (
	AddPerson__) 2
(__2 3
)__3 4
{`` 	
boolaa 
canEditaa 
=aa 
awaitaa  
_userDataServiceaa! 1
.aa1 2
CanEditPageaa2 =
(aa= >
ControllerContextaa> O
.aaO P
ActionDescriptoraaP `
.aa` a

ActionNameaaa k
)aak l
;aal m
varbb 
	viewModelbb 
=bb 
newbb 
AddPersonViewModelbb  2
{cc 
Sitesdd 
=dd 
(dd 
awaitdd 
_personServicedd -
.dd- .
GetAllSitesAsyncdd. >
(dd> ?
siteAlldd? F
)ddF G
)ddG H
.ee 
Selectee 
(ee 
pee 
=>ee  
newee! $
SelectListItemee% 3
{ee4 5
Valueee6 ;
=ee< =
pee> ?
.ee? @
PlantNoee@ G
.eeG H
ToStringeeH P
(eeP Q
)eeQ R
,eeR S
TexteeT X
=eeY Z
pee[ \
.ee\ ]
Nameee] a
}eeb c
)eec d
.ff 
ToListff 
(ff 
)ff 
}gg 
;gg 
	viewModelhh 
.hh 
CanEdithh 
=hh 
canEdithh  '
;hh' (
returnii 
Viewii 
(ii 
	viewModelii !
)ii! "
;ii" #
}jj 	
[kk 	
HttpPostkk	 
]kk 
publicll 
asyncll 
Taskll 
<ll 
IActionResultll '
>ll' (
	AddPersonll) 2
(ll2 3
AddPersonViewModelll3 E
	viewModelllF O
)llO P
{mm 	
boolnn 
canEditnn 
=nn 
awaitnn  
_userDataServicenn! 1
.nn1 2
CanEditPagenn2 =
(nn= >
ControllerContextnn> O
.nnO P
ActionDescriptornnP `
.nn` a

ActionNamenna k
)nnk l
;nnl m
stringpp 
userNamepp 
=pp 
_userDataServicepp .
.pp. /
GetUsernamepp/ :
(pp: ;
)pp; <
??pp= ?
$strpp@ B
;ppB C
ifqq 
(qq 
!qq 

ModelStateqq 
.qq 
IsValidqq #
)qq# $
{rr 
	viewModelss 
.ss 
Sitesss 
=ss  !
(ss" #
awaitss# (
_personServicess) 7
.ss7 8
GetAllSitesAsyncss8 H
(ssH I
siteAllssI P
)ssP Q
)ssQ R
.tt 
Selecttt 
(tt 
ptt 
=>tt  
newtt! $
SelectListItemtt% 3
{tt4 5
Valuett6 ;
=tt< =
ptt> ?
.tt? @
PlantNott@ G
.ttG H
ToStringttH P
(ttP Q
)ttQ R
,ttR S
TextttT X
=ttY Z
ptt[ \
.tt\ ]
Namett] a
}ttb c
)ttc d
.uu 
ToListuu 
(uu 
)uu 
;uu 
	viewModelvv 
.vv 
CanEditvv !
=vv" #
canEditvv$ +
;vv+ ,
returnww 
Viewww 
(ww 
	viewModelww %
)ww% &
;ww& '
}xx 
tryzz 
{{{ 
if|| 
(|| 
canEdit|| 
)|| 
{}} 
var~~ 

personData~~ "
=~~# $
_mapper~~% ,
.~~, -
Map~~- 0
<~~0 1
AddPersonDto~~1 =
>~~= >
(~~> ?
	viewModel~~? H
)~~H I
;~~I J
var 
message 
=  !
await" '
_personService( 6
.6 7
AddPersonAsync7 E
(E F

personDataF P
,P Q
userNameR Z
)Z [
;[ \
TempData
€€ 
[
€€ 
personMessage
€€ *
]
€€* +
=
€€, -
message
€€. 5
;
€€5 6
}
 
}
‚‚ 
catch
ƒƒ 
(
ƒƒ 
SqlException
ƒƒ 
sqlEx
ƒƒ  %
)
ƒƒ% &
{
„„ 
_logService
…… 
.
…… 
LogSqlException
…… +
(
……+ ,
sqlEx
……, 1
,
……1 2
ControllerContext
……3 D
.
……D E
ActionDescriptor
……E U
.
……U V

ActionName
……V `
)
……` a
;
……a b
TempData
†† 
[
†† 
personMessage
†† &
]
††& '
=
††( )
$str
††* 7
;
††7 8
}
‡‡ 
catch
ˆˆ 
(
ˆˆ 
	Exception
ˆˆ 
ex
ˆˆ 
)
ˆˆ  
{
‰‰ 
_logService
ŠŠ 
.
ŠŠ !
LogGeneralException
ŠŠ /
(
ŠŠ/ 0
ex
ŠŠ0 2
,
ŠŠ2 3
ControllerContext
ŠŠ4 E
.
ŠŠE F
ActionDescriptor
ŠŠF V
.
ŠŠV W

ActionName
ŠŠW a
)
ŠŠa b
;
ŠŠb c
TempData
‹‹ 
[
‹‹ 
personMessage
‹‹ &
]
‹‹& '
=
‹‹( )
$str
‹‹* 7
;
‹‹7 8
}
ŒŒ 
return
ŽŽ 
RedirectToAction
ŽŽ #
(
ŽŽ# $
nameof
ŽŽ$ *
(
ŽŽ* +
	AddPerson
ŽŽ+ 4
)
ŽŽ4 5
)
ŽŽ5 6
;
ŽŽ6 7
}
 	
[
 	
HttpGet
	 
]
 
public
‘‘ 
async
‘‘ 
Task
‘‘ 
<
‘‘ 
IActionResult
‘‘ '
>
‘‘' (

EditPerson
‘‘) 3
(
‘‘3 4
int
‘‘4 7
id
‘‘8 :
)
‘‘: ;
{
’’ 	
bool
““ 
canEdit
““ 
=
““ 
await
““  
_userDataService
““! 1
.
““1 2
CanEditPage
““2 =
(
““= >
ControllerContext
““> O
.
““O P
ActionDescriptor
““P `
.
““` a

ActionName
““a k
)
““k l
;
““l m
if
”” 
(
”” 
!
”” 

ModelState
”” 
.
”” 
IsValid
”” #
)
””# $
{
•• 
return
–– 
RedirectToAction
–– '
(
––' (
nameof
––( .
(
––. /

ViewPerson
––/ 9
)
––9 :
)
––: ;
;
––; <
}
—— 
var
˜˜ 
person
˜˜ 
=
˜˜ 
await
˜˜ 
_personService
˜˜ -
.
˜˜- .$
GetPersonNameByIdAsync
˜˜. D
(
˜˜D E
id
˜˜E G
)
˜˜G H
;
˜˜H I
var
™™ 
siteName
™™ 
=
™™ 
await
™™  
_personService
™™! /
.
™™/ 0
GetSiteByIdAsync
™™0 @
(
™™@ A
id
™™A C
)
™™C D
;
™™D E
if
šš 
(
šš 
person
šš 
==
šš 
null
šš 
)
šš 
{
›› 
return
œœ 
RedirectToAction
œœ '
(
œœ' (
nameof
œœ( .
(
œœ. /

ViewPerson
œœ/ 9
)
œœ9 :
)
œœ: ;
;
œœ; <
}
 
var
žž 
	viewModel
žž 
=
žž 
new
žž !
EditPersonViewModel
žž  3
{
ŸŸ 
CanEdit
   
=
   
canEdit
   !
,
  ! "
PersonId
¡¡ 
=
¡¡ 
id
¡¡ 
,
¡¡ 
Person
¢¢ 
=
¢¢ 
person
¢¢ 
,
¢¢  
Name
££ 
=
££ 
siteName
££ 
,
££  
SiteOptions
¤¤ 
=
¤¤ 
(
¤¤ 
await
¤¤ $
_personService
¤¤% 3
.
¤¤3 4
GetAllSitesAsync
¤¤4 D
(
¤¤D E
siteAll
¤¤E L
)
¤¤L M
)
¤¤M N
.
¥¥ 
Select
¥¥ 
(
¥¥ 
p
¥¥ 
=>
¥¥  
new
¥¥! $
SelectListItem
¥¥% 3
{
¥¥4 5
Value
¥¥6 ;
=
¥¥< =
p
¥¥> ?
.
¥¥? @
PlantNo
¥¥@ G
.
¥¥G H
ToString
¥¥H P
(
¥¥P Q
)
¥¥Q R
,
¥¥R S
Text
¥¥T X
=
¥¥Y Z
p
¥¥[ \
.
¥¥\ ]
Name
¥¥] a
}
¥¥b c
)
¥¥c d
.
¦¦ 
ToList
¦¦ 
(
¦¦ 
)
¦¦ 
}
§§ 
;
§§ 
return
©© 
View
©© 
(
©© 
	viewModel
©© !
)
©©! "
;
©©" #
}
ªª 	
[
¬¬ 	
HttpPost
¬¬	 
]
¬¬ 
public
­­ 
async
­­ 
Task
­­ 
<
­­ 
IActionResult
­­ '
>
­­' (

EditPerson
­­) 3
(
­­3 4!
EditPersonViewModel
­­4 G
	viewModel
­­H Q
)
­­Q R
{
®® 	
bool
¯¯ 
canEdit
¯¯ 
=
¯¯ 
await
¯¯  
_userDataService
¯¯! 1
.
¯¯1 2
CanEditPage
¯¯2 =
(
¯¯= >
ControllerContext
¯¯> O
.
¯¯O P
ActionDescriptor
¯¯P `
.
¯¯` a

ActionName
¯¯a k
)
¯¯k l
;
¯¯l m
if
±± 
(
±± 
!
±± 

ModelState
±± 
.
±± 
IsValid
±± #
)
±±# $
{
²² 
var
³³ 
sites
³³ 
=
³³ 
await
³³ !
_personService
³³" 0
.
³³0 1
GetAllSitesAsync
³³1 A
(
³³A B
siteAll
³³B I
)
³³I J
;
³³J K
	viewModel
µµ 
.
µµ 
SiteOptions
µµ %
=
µµ& '
sites
µµ( -
.
µµ- .
Select
¶¶ 
(
¶¶ 
p
¶¶ 
=>
¶¶ 
new
¶¶  
SelectListItem
¶¶! /
{
¶¶0 1
Value
¶¶2 7
=
¶¶8 9
p
¶¶: ;
.
¶¶; <
PlantNo
¶¶< C
.
¶¶C D
ToString
¶¶D L
(
¶¶L M
)
¶¶M N
,
¶¶N O
Text
¶¶P T
=
¶¶U V
p
¶¶W X
.
¶¶X Y
Name
¶¶Y ]
}
¶¶^ _
)
¶¶_ `
.
·· 
ToList
·· 
(
·· 
)
·· 
;
·· 
	viewModel
¹¹ 
.
¹¹ 
CanEdit
¹¹ !
=
¹¹" #
canEdit
¹¹$ +
;
¹¹+ ,
return
ºº 
View
ºº 
(
ºº 
	viewModel
ºº %
)
ºº% &
;
ºº& '
}
»» 
try
¼¼ 
{
½½ 
if
¾¾ 
(
¾¾ 
canEdit
¾¾ 
)
¾¾ 
{
¿¿ 
var
ÀÀ 
editTraining
ÀÀ $
=
ÀÀ% &
_mapper
ÀÀ' .
.
ÀÀ. /
Map
ÀÀ/ 2
<
ÀÀ2 3
EditPersonDto
ÀÀ3 @
>
ÀÀ@ A
(
ÀÀA B
	viewModel
ÀÀB K
)
ÀÀK L
;
ÀÀL M
var
ÁÁ 
message
ÁÁ 
=
ÁÁ  !
await
ÁÁ" '
_personService
ÁÁ( 6
.
ÁÁ6 7
UpdatePersonAsync
ÁÁ7 H
(
ÁÁH I
editTraining
ÁÁI U
)
ÁÁU V
;
ÁÁV W
TempData
ÃÃ 
[
ÃÃ 
personMessage
ÃÃ *
]
ÃÃ* +
=
ÃÃ, -
message
ÃÃ. 5
;
ÃÃ5 6
}
ÄÄ 
}
ÆÆ 
catch
ÇÇ 
(
ÇÇ 
SqlException
ÇÇ 
sqlEx
ÇÇ  %
)
ÇÇ% &
{
ÈÈ 
_logService
ÉÉ 
.
ÉÉ 
LogSqlException
ÉÉ +
(
ÉÉ+ ,
sqlEx
ÉÉ, 1
,
ÉÉ1 2
ControllerContext
ÉÉ3 D
.
ÉÉD E
ActionDescriptor
ÉÉE U
.
ÉÉU V

ActionName
ÉÉV `
)
ÉÉ` a
;
ÉÉa b
TempData
ÊÊ 
[
ÊÊ 
personMessage
ÊÊ &
]
ÊÊ& '
=
ÊÊ( )
$str
ÊÊ* 9
;
ÊÊ9 :
}
ËË 
catch
ÌÌ 
(
ÌÌ 
	Exception
ÌÌ 
ex
ÌÌ 
)
ÌÌ  
{
ÍÍ 
_logService
ÎÎ 
.
ÎÎ !
LogGeneralException
ÎÎ /
(
ÎÎ/ 0
ex
ÎÎ0 2
,
ÎÎ2 3
ControllerContext
ÎÎ4 E
.
ÎÎE F
ActionDescriptor
ÎÎF V
.
ÎÎV W

ActionName
ÎÎW a
)
ÎÎa b
;
ÎÎb c
TempData
ÏÏ 
[
ÏÏ 
personMessage
ÏÏ &
]
ÏÏ& '
=
ÏÏ( )
$str
ÏÏ* 9
;
ÏÏ9 :
}
ÐÐ 
return
ÒÒ 
RedirectToAction
ÒÒ #
(
ÒÒ# $
nameof
ÒÒ$ *
(
ÒÒ* +

EditPerson
ÒÒ+ 5
)
ÒÒ5 6
)
ÒÒ6 7
;
ÒÒ7 8
}
ÕÕ 	
}
ÖÖ 
}×× Õ’
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\NewsController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
NewsController 
:  !

Controller" ,
{ 
private 
readonly 
INewsService %
_newsService& 2
;2 3
private 
readonly 
IUserService %
_userService& 2
;2 3
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
ILogService $
_logService% 0
;0 1
private 
const 
string 
newsMessage (
=) *
$str+ 8
;8 9
private 
const 
string 
newsLoadingMessage /
=0 1
$str2 F
;F G
public 
NewsController 
( 
INewsService *
newsService+ 6
,6 7
IUserService8 D
userServiceE P
,P Q
IMapperR Y
mapperZ `
,` a
IUserDataServiceb r
userDataService	s ‚
,
‚ ƒ
ILogService
ƒ Ž

logService
 ™
)
™ š
{ 	
_newsService 
= 
newsService &
;& '
_userService 
= 
userService &
;& '
_mapper 
= 
mapper 
; 
_userDataService 
= 
userDataService .
;. /
_logService 
= 

logService $
;$ %
} 	
[!! 	
HttpGet!!	 
]!! 
public"" 
async"" 
Task"" 
<"" 
IActionResult"" '
>""' (
AddNews"") 0
(""0 1
)""1 2
{## 	
bool$$ 
canEdit$$ 
=$$ 
await$$  
_userDataService$$! 1
.$$1 2
CanEditPage$$2 =
($$= >
ControllerContext$$> O
.$$O P
ActionDescriptor$$P `
.$$` a

ActionName$$a k
)$$k l
;$$l m
var%% 
	viewModel%% 
=%% 
new%% 
AddNewsViewModel%%  0
{&& 
DatePublished'' 
='' 
DateTime''  (
.''( )
Now'') ,
,'', -
Users(( 
=(( 
((( 
await(( 
_userService(( +
.((+ ,
GetUsersAsync((, 9
(((9 :
$str((: E
)((E F
)((F G
.)) 
Select)) 
()) 
u)) 
=>))  
new))! $
SelectListItem))% 3
{))4 5
Value))6 ;
=))< =
u))> ?
.))? @
UserId))@ F
,))F G
Text))H L
=))M N
u))O P
.))P Q
UserName))Q Y
}))Z [
)))[ \
.** 
ToList** 
(** 
)** 
,** 
CanEdit++ 
=++ 
canEdit++ !
},, 
;,, 
var// 
	usersList// 
=// 
	viewModel// %
.//% &
Users//& +
.//+ ,
ToList//, 2
(//2 3
)//3 4
;//4 5
	usersList00 
.00 
Insert00 
(00 
$num00 
,00 
new00  #
SelectListItem00$ 2
{003 4
Value005 :
=00; <
$str00= ?
,00? @
Text00A E
=00F G
$str00H \
,00\ ]
Selected00^ f
=00g h
true00i m
}00n o
)00o p
;00p q
	viewModel11 
.11 
Users11 
=11 
	usersList11 '
;11' (
return33 
View33 
(33 
	viewModel33 !
)33! "
;33" #
}44 	
[66 	
HttpPost66	 
]66 
[77 	$
ValidateAntiForgeryToken77	 !
]77! "
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (
AddNews88) 0
(880 1
AddNewsViewModel881 A
	viewModel88B K
)88K L
{99 	
bool:: 
canEdit:: 
=:: 
await::  
_userDataService::! 1
.::1 2
CanEditPage::2 =
(::= >
ControllerContext::> O
.::O P
ActionDescriptor::P `
.::` a

ActionName::a k
)::k l
;::l m
if;; 
(;; 
	viewModel;; 
.;; 
UseCurrentDateTime;; ,
);;, -
{<< 
	viewModel== 
.== 
DatePublished== '
===( )
DateTime==* 2
.==2 3
Now==3 6
;==6 7

ModelState>> 
.>> 
Clear>>  
(>>  !
)>>! "
;>>" #
TryValidateModel??  
(??  !
	viewModel??! *
)??* +
;??+ ,
}@@ 
ifAA 
(AA 
	viewModelAA 
.AA 
DatePublishedAA '
.AA' (
HourAA( ,
==AA- /
$numAA0 1
&&AA2 4
	viewModelAA5 >
.AA> ?
DatePublishedAA? L
.AAL M
MinuteAAM S
==AAT V
$numAAW X
&&AAY [
	viewModelAA\ e
.AAe f
DatePublishedAAf s
.AAs t
SecondAAt z
==AA{ }
$numAA~ 
)	AA €
{BB 
	viewModelCC 
.CC 
DatePublishedCC '
=CC( )
newCC* -
DateTimeCC. 6
(CC6 7
	viewModelDD 
.DD 
DatePublishedDD +
.DD+ ,
YearDD, 0
,DD0 1
	viewModelEE 
.EE 
DatePublishedEE +
.EE+ ,
MonthEE, 1
,EE1 2
	viewModelFF 
.FF 
DatePublishedFF +
.FF+ ,
DayFF, /
,FF/ 0
$numGG 
,GG 
$numGG 
,GG 
$numGG 
,GG 
DateTimeKindGG )
.GG) *
LocalGG* /
)GG/ 0
;GG0 1

ModelStateHH 
.HH 
RemoveHH !
(HH! "
$strHH" 1
)HH1 2
;HH2 3
TryValidateModelII  
(II  !
	viewModelII! *
)II* +
;II+ ,
}JJ 
ifLL 
(LL 
!LL 

ModelStateLL 
.LL 
IsValidLL #
)LL# $
{MM 
	viewModelNN 
.NN 
UsersNN 
=NN  !
(NN" #
awaitNN# (
_userServiceNN) 5
.NN5 6
GetUsersAsyncNN6 C
(NNC D
$strNND O
)NNO P
)NNP Q
.OO 
SelectOO 
(OO 
uOO 
=>OO  
newOO! $
SelectListItemOO% 3
{OO4 5
ValueOO6 ;
=OO< =
uOO> ?
.OO? @
UserIdOO@ F
,OOF G
TextOOH L
=OOM N
uOOO P
.OOP Q
UserNameOOQ Y
}OOZ [
)OO[ \
.PP 
ToListPP 
(PP 
)PP 
;PP 
varSS 
	usersListSS 
=SS 
	viewModelSS  )
.SS) *
UsersSS* /
.SS/ 0
ToListSS0 6
(SS6 7
)SS7 8
;SS8 9
	usersListTT 
.TT 
InsertTT  
(TT  !
$numTT! "
,TT" #
newTT$ '
SelectListItemTT( 6
{TT7 8
ValueTT9 >
=TT? @
$strTTA C
,TTC D
TextTTE I
=TTJ K
$strTTL `
,TT` a
SelectedTTb j
=TTk l
trueTTm q
}TTr s
)TTs t
;TTt u
	viewModelUU 
.UU 
UsersUU 
=UU  !
	usersListUU" +
;UU+ ,
	viewModelVV 
.VV 
CanEditVV !
=VV" #
canEditVV$ +
;VV+ ,
returnXX 
ViewXX 
(XX 
	viewModelXX %
)XX% &
;XX& '
}YY 
try[[ 
{\\ 
if]] 
(]] 
canEdit]] 
)]] 
{^^ 
var__ 
dto__ 
=__ 
_mapper__ %
.__% &
Map__& )
<__) *
NewsDto__* 1
>__1 2
(__2 3
	viewModel__3 <
)__< =
;__= >
TempData`` 
[`` 
newsMessage`` (
]``( )
=``* +
await``, 1
_newsService``2 >
.``> ?
AddNewsAsync``? K
(``K L
dto``L O
)``O P
;``P Q
}aa 
elsebb 
{cc 
TempDatadd 
[dd 
newsMessagedd (
]dd( )
=dd* +
$strdd, `
;dd` a
}ee 
}ff 
catchgg 
(gg 
SqlExceptiongg 
sqlExgg  %
)gg% &
{hh 
_logServiceii 
.ii 
LogSqlExceptionii +
(ii+ ,
sqlExii, 1
,ii1 2
ControllerContextii3 D
.iiD E
ActionDescriptoriiE U
.iiU V

ActionNameiiV `
)ii` a
;iia b
TempDatajj 
[jj 
newsMessagejj $
]jj$ %
=jj& '
$strjj( 5
;jj5 6
}kk 
catchll 
(ll 
	Exceptionll 
exll 
)ll  
{mm 
_logServicenn 
.nn 
LogGeneralExceptionnn /
(nn/ 0
exnn0 2
,nn2 3
ControllerContextnn4 E
.nnE F
ActionDescriptornnF V
.nnV W

ActionNamennW a
)nna b
;nnb c
TempDataoo 
[oo 
newsMessageoo $
]oo$ %
=oo& '
$stroo( 5
;oo5 6
}pp 
returnqq 
RedirectToActionqq #
(qq# $
nameofqq$ *
(qq* +
AddNewsqq+ 2
)qq2 3
)qq3 4
;qq4 5
}rr 	
[ss 	
HttpGetss	 
]ss 
publictt 
asynctt 
Tasktt 
<tt 
IActionResulttt '
>tt' (
ViewNewstt) 1
(tt1 2
)tt2 3
{uu 	
boolvv 
canEditvv 
=vv 
awaitvv  
_userDataServicevv! 1
.vv1 2
CanEditPagevv2 =
(vv= >
ControllerContextvv> O
.vvO P
ActionDescriptorvvP `
.vv` a

ActionNamevva k
)vvk l
;vvl m
varww 
	viewModelww 
=ww 
newww 
ViewNewsViewModelww  1
{xx 
CanEdityy 
=yy 
canEdityy !
}zz 
;zz 
try|| 
{}} 
	viewModel~~ 
.~~ 
NewsList~~ "
=~~# $
await~~% *
_newsService~~+ 7
.~~7 8
GetNewsAsync~~8 D
(~~D E
)~~E F
;~~F G
if
€€ 
(
€€ 
TempData
€€ 
[
€€ 
newsMessage
€€ (
]
€€( )
!=
€€* ,
null
€€- 1
)
€€1 2
{
 
	viewModel
‚‚ 
.
‚‚ 
Message
‚‚ %
=
‚‚& '
TempData
‚‚( 0
[
‚‚0 1
newsMessage
‚‚1 <
]
‚‚< =
?
‚‚= >
.
‚‚> ?
ToString
‚‚? G
(
‚‚G H
)
‚‚H I
;
‚‚I J
}
ƒƒ 
}
„„ 
catch
…… 
(
…… 
SqlException
…… 
sqlEx
……  %
)
……% &
{
†† 
_logService
‡‡ 
.
‡‡ 
LogSqlException
‡‡ +
(
‡‡+ ,
sqlEx
‡‡, 1
,
‡‡1 2
ControllerContext
‡‡3 D
.
‡‡D E
ActionDescriptor
‡‡E U
.
‡‡U V

ActionName
‡‡V `
)
‡‡` a
;
‡‡a b
	viewModel
ˆˆ 
.
ˆˆ 
Message
ˆˆ !
=
ˆˆ" # 
newsLoadingMessage
ˆˆ$ 6
;
ˆˆ6 7
}
‰‰ 
catch
ŠŠ 
(
ŠŠ 
	Exception
ŠŠ 
ex
ŠŠ 
)
ŠŠ  
{
‹‹ 
_logService
ŒŒ 
.
ŒŒ !
LogGeneralException
ŒŒ /
(
ŒŒ/ 0
ex
ŒŒ0 2
,
ŒŒ2 3
ControllerContext
ŒŒ4 E
.
ŒŒE F
ActionDescriptor
ŒŒF V
.
ŒŒV W

ActionName
ŒŒW a
)
ŒŒa b
;
ŒŒb c
	viewModel
 
.
 
Message
 !
=
" # 
newsLoadingMessage
$ 6
;
6 7
}
ŽŽ 
return
 
View
 
(
 
	viewModel
 !
)
! "
;
" #
}
 	
[
’’ 	
HttpPost
’’	 
]
’’ 
[
““ 	&
ValidateAntiForgeryToken
““	 !
]
““! "
public
”” 
async
”” 
Task
”” 
<
”” 
IActionResult
”” '
>
””' (

DeleteNews
””) 3
(
””3 4
string
””4 :
title
””; @
)
””@ A
{
•• 	
bool
–– 
canEdit
–– 
=
–– 
await
––  
_userDataService
––! 1
.
––1 2
CanEditPage
––2 =
(
––= >
ControllerContext
––> O
.
––O P
ActionDescriptor
––P `
.
––` a

ActionName
––a k
)
––k l
;
––l m
try
—— 
{
˜˜ 
if
™™ 
(
™™ 
canEdit
™™ 
)
™™ 
{
šš 
var
›› 
message
›› 
=
››  !
await
››" '
_newsService
››( 4
.
››4 5
DeleteNewsAsync
››5 D
(
››D E
title
››E J
)
››J K
;
››K L
TempData
œœ 
[
œœ 
newsMessage
œœ (
]
œœ( )
=
œœ* +
message
œœ, 3
;
œœ3 4
}
 
else
žž 
{
ŸŸ 
TempData
   
[
   
newsMessage
   (
]
  ( )
=
  * +
$str
  , `
;
  ` a
}
¡¡ 
}
¢¢ 
catch
££ 
(
££ 
SqlException
££ 
sqlEx
££  %
)
££% &
{
¤¤ 
_logService
¥¥ 
.
¥¥ 
LogSqlException
¥¥ +
(
¥¥+ ,
sqlEx
¥¥, 1
,
¥¥1 2
ControllerContext
¥¥3 D
.
¥¥D E
ActionDescriptor
¥¥E U
.
¥¥U V

ActionName
¥¥V `
)
¥¥` a
;
¥¥a b
TempData
¦¦ 
[
¦¦ 
newsMessage
¦¦ $
]
¦¦$ %
=
¦¦& '
$str
¦¦( 7
;
¦¦7 8
}
§§ 
catch
¨¨ 
(
¨¨ 
	Exception
¨¨ 
ex
¨¨ 
)
¨¨  
{
©© 
_logService
ªª 
.
ªª !
LogGeneralException
ªª /
(
ªª/ 0
ex
ªª0 2
,
ªª2 3
ControllerContext
ªª4 E
.
ªªE F
ActionDescriptor
ªªF V
.
ªªV W

ActionName
ªªW a
)
ªªa b
;
ªªb c
TempData
«« 
[
«« 
newsMessage
«« $
]
««$ %
=
««& '
$str
««( 7
;
««7 8
}
¬¬ 
return
­­ 
RedirectToAction
­­ #
(
­­# $
nameof
­­$ *
(
­­* +
ViewNews
­­+ 3
)
­­3 4
)
­­4 5
;
­­5 6
}
®® 	
[
°° 	
HttpGet
°°	 
]
°° 
public
±± 
async
±± 
Task
±± 
<
±± 
IActionResult
±± '
>
±±' (
OldNews
±±) 0
(
±±0 1
)
±±1 2
{
²² 	
bool
³³ 
canEdit
³³ 
=
³³ 
await
³³  
_userDataService
³³! 1
.
³³1 2
CanEditPage
³³2 =
(
³³= >
ControllerContext
³³> O
.
³³O P
ActionDescriptor
³³P `
.
³³` a

ActionName
³³a k
)
³³k l
;
³³l m
var
µµ 
	viewModel
µµ 
=
µµ 
new
µµ 
OldNewsViewModel
µµ  0
{
¶¶ 
CanEdit
·· 
=
·· 
canEdit
·· !
}
¸¸ 
;
¸¸ 
try
ºº 
{
»» 
	viewModel
¼¼ 
.
¼¼ 
NewsList
¼¼ "
=
¼¼# $
await
¼¼% *
_newsService
¼¼+ 7
.
¼¼7 8
GetNewsAsync
¼¼8 D
(
¼¼D E
)
¼¼E F
;
¼¼F G
if
¾¾ 
(
¾¾ 
TempData
¾¾ 
[
¾¾ 
newsMessage
¾¾ (
]
¾¾( )
!=
¾¾* ,
null
¾¾- 1
)
¾¾1 2
{
¿¿ 
	viewModel
ÀÀ 
.
ÀÀ 
Message
ÀÀ %
=
ÀÀ& '
TempData
ÀÀ( 0
[
ÀÀ0 1
newsMessage
ÀÀ1 <
]
ÀÀ< =
?
ÀÀ= >
.
ÀÀ> ?
ToString
ÀÀ? G
(
ÀÀG H
)
ÀÀH I
;
ÀÀI J
}
ÁÁ 
}
ÂÂ 
catch
ÃÃ 
(
ÃÃ 
SqlException
ÃÃ 
sqlEx
ÃÃ  %
)
ÃÃ% &
{
ÄÄ 
_logService
ÅÅ 
.
ÅÅ 
LogSqlException
ÅÅ +
(
ÅÅ+ ,
sqlEx
ÅÅ, 1
,
ÅÅ1 2
$str
ÅÅ3 <
)
ÅÅ< =
;
ÅÅ= >
	viewModel
ÆÆ 
.
ÆÆ 
Message
ÆÆ !
=
ÆÆ" # 
newsLoadingMessage
ÆÆ$ 6
;
ÆÆ6 7
}
ÇÇ 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
ex
ÈÈ 
)
ÈÈ  
{
ÉÉ 
_logService
ÊÊ 
.
ÊÊ !
LogGeneralException
ÊÊ /
(
ÊÊ/ 0
ex
ÊÊ0 2
,
ÊÊ2 3
$str
ÊÊ4 =
)
ÊÊ= >
;
ÊÊ> ?
	viewModel
ËË 
.
ËË 
Message
ËË !
=
ËË" # 
newsLoadingMessage
ËË$ 6
;
ËË6 7
}
ÌÌ 
return
ÍÍ 
View
ÍÍ 
(
ÍÍ 
	viewModel
ÍÍ !
)
ÍÍ! "
;
ÍÍ" #
}
ÎÎ 	
}
ÑÑ 
}ÒÒ Ü
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\HomeController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{		 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private 
readonly 
INewsService %
_newsServicee& 3
;3 4
private 
readonly 
IMapper  
_mapper! (
;( )
public 
HomeController 
( 
INewsService *
newsServicee+ 7
,7 8
IMapper9 @
mapperA G
)G H
{ 	
_newsServicee 
= 
newsServicee (
;( )
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
)/ 0
{ 	
var 
latestNewsDto 
= 
await  %
_newsServicee& 3
.3 4
GetLatestNewsAsync4 F
(F G
)G H
;H I
var 

latestNews 
= 
_mapper $
.$ %
Map% (
<( )
IEnumerable) 4
<4 5
NewsViewModel5 B
>B C
>C D
(D E
latestNewsDtoE R
)R S
;S T
return 
View 
( 

latestNews "
)" #
;# $
} 	
} 
}   ã
ND:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\HelpController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
HelpController 
:  !

Controller" ,
{		 
public 
IActionResult 
Help !
(! "
int" %
index& +
=, -
$num. /
)/ 0
{ 	
if 
( 
! 

ModelState 
. 
IsValid "
)" #
{ 
return 
RedirectToAction '
(' (
nameof( .
(. /
Help/ 3
)3 4
)4 5
;5 6
} 
index 
= 
Math 
. 
Max 
( 
$num 
, 
index  %
)% &
;& '
var 
sections 
= 
new 
List #
<# $
HelpListViewModel$ 5
>5 6
{ 
new 
( 
) 
{ 
Title 
= 
$str '
,' (
ImageUrl) 1
=2 3
$str4 L
,L M
DescriptionN Y
=Z [
$str	\ 
}
 ‘
,
‘ ’
new 
( 
) 
{ 
Title 
= 
$str '
,' (
ImageUrl) 1
=2 3
$str4 I
,I J
DescriptionK V
=W X
$str	Y š
}
› œ
,
œ 
new 
( 
) 
{ 
Title 
= 
$str *
,* +
ImageUrl, 4
=5 6
$str7 O
,O P
DescriptionP [
=\ ]
$str	^ ¢
,
¢ £
AdditionalInfo
£ ±
=
² ³
$str
´ ’
}
“ ”
,
” •
new 
( 
) 
{ 
Title 
= 
$str *
,* +
ImageUrl, 4
=5 6
$str7 O
,O P
DescriptionP [
=\ ]
$str	^ ¢
}
£ ¤
,
¤ ¥
new 
( 
) 
{ 
Title 
= 
$str +
,+ ,
ImageUrl- 5
=6 7
$str8 Q
,Q R
DescriptionR ]
=^ _
$str	` ¤
}
¥ ¦
,
¦ §
new 
( 
) 
{ 
Title 
= 
$str 4
,4 5
ImageUrl7 ?
=@ A
$strB ^
,^ _
Description_ j
=k l
$str	m µ
}
¶ ·
,
· ¸
new 
( 
) 
{ 
Title 
= 
$str '
,' (
ImageUrl( 0
=1 2
$str3 E
,E F
DescriptionF Q
=R S
$strT }
}~ 
,	 €
new 
( 
) 
{ 
Title 
= 
$str '
,' (
ImageUrl( 0
=1 2
$str3 H
}I J
} 
; 
return 
View 
( 
new 
HelpViewModel )
{* +
ActiveViewIndex, ;
=< =
index> C
,C D
SectionsE M
=N O
sectionsP X
}Y Z
)Z [
;[ \
}   	
}!! 
}"" ±	
OD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\ErrorController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
AllowAnonymous 
] 
public		 

class		 
ErrorController		  
:		! "

Controller		# -
{

 
public 
IActionResult 
AccessDenied )
() *
)* +
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
} 
} Î>
RD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\AuditLogController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{ 
[ 
	Authorize 
] 
public 

class 
AuditLogController #
:$ %

Controller& 0
{ 
private 
readonly 
IAuditLogService )
_auditLogService* :
;: ;
private 
readonly 
IUserDataService )
_userDataService* :
;: ;
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
ILogService $
_logService% 0
;0 1
public 
AuditLogController !
(! "
IAuditLogService" 2
auditLogService3 B
,B C
IMapperD K
mapperL R
,R S
IUserDataServiceT d
userDataServicee t
,t u
ILogService	v 

logService
‚ Œ
)
Œ 
{ 	
_auditLogService 
= 
auditLogService .
??/ 1
throw2 7
new8 ;!
ArgumentNullException< Q
(Q R
nameofR X
(X Y
auditLogServiceY h
)h i
)i j
;j k
_mapper 
= 
mapper 
; 
_userDataService 
= 
userDataService .
;. /
_logService 
= 

logService $
;$ %
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
int/ 2
pageNo3 9
=: ;
$num< =
,= >
string? E
columnF L
=M N
$strO Q
,Q R
boolS W
	sortOrderX a
=b c
falsed i
,i j
stringk q
storedProcedure	r 
=
‚ ƒ
$str
„ ‡
)
‡ ˆ
{   	
if!! 
(!! 
!!! 

ModelState!! 
.!! 
IsValid!! #
)!!# $
{"" 
return## 

BadRequest## !
(##! "
$str##" 6
)##6 7
;##7 8
}$$ 
QueryParameters%% 
queryParameters%% +
=%%, -
new%%. 1
QueryParameters%%2 A
{&& 
Search'' 
='' 
storedProcedure'' (
,''( )
Page(( 
=(( 
pageNo(( 
,(( 
PageSize)) 
=)) 
$num)) 
,)) 
SortBy** 
=** 
column** 
,**  

Descending++ 
=++ 
	sortOrder++ &
}-- 
;-- 
var.. 
auditLogsDto.. 
=.. 
await.. $
_auditLogService..% 5
...5 6
GetAuditLogsAsync..6 G
(..G H
queryParameters..H W
,..W X
storedProcedure..Y h
)..h i
;..i j
var// 
	auditLogs// 
=// 
_mapper// #
.//# $
Map//$ '
<//' (
IEnumerable//( 3
<//3 4
AuditLogViewModel//4 E
>//E F
>//F G
(//G H
auditLogsDto//H T
.//T U
data//U Y
)//Y Z
;//Z [
List22 
<22 
string22 
>22  
storedProcedureNames22 -
=22. /
await220 5
_auditLogService226 F
.22F G(
GetStoredProcedureNamesAsync22G c
(22c d
)22d e
;22e f
var33 
dropDownList33 
=33  
storedProcedureNames33 3
.44 
Select44 
(44 
name44 
=>44 
new44  #
SelectListItem44$ 2
{55 
Value66 
=66 
name66  
,66  !
Text77 
=77 
name77 
}88 
)88 
.99 
ToList99 
(99 
)99 
;99 
var<< 
model<< 
=<< 
new<< !
AuditLogListViewModel<< 1
{== 
AuditLogsResults>>  
=>>! "
	auditLogs>># ,
.>>, -
ToList>>- 3
(>>3 4
)>>4 5
,>>5 6
StoredProcedures??  
=??! "
dropDownList??# /
,??/ 0
StoredProcedure@@ 
=@@  !
storedProcedure@@" 1
,@@1 2

PaginationAA 
=AA 
newAA  
PaginationModelAA! 0
{BB 

TotalCountCC 
=CC  
auditLogsDtoCC! -
.CC- .

TotalCountCC. 8
,CC8 9

PageNumberDD 
=DD  
queryParametersDD! 0
.DD0 1
PageDD1 5
,DD5 6
PageSizeEE 
=EE 
queryParametersEE .
.EE. /
PageSizeEE/ 7
,EE7 8

SortColumnFF 
=FF  
queryParametersFF! 0
.FF0 1
SortByFF1 7
,FF7 8
SortDirectionGG !
=GG" #
queryParametersGG$ 3
.GG3 4

DescendingGG4 >
}HH 
}II 
;II 
returnKK 
ViewKK 
(KK 
modelKK 
)KK 
;KK 
}LL 	
[OO 	
HttpPostOO	 
]OO 
publicPP 
asyncPP 
TaskPP 
<PP 
IActionResultPP '
>PP' (
ArchiveAuditLogPP) 8
(PP8 9
)PP9 :
{QQ 	
tryRR 
{SS 
stringTT 
userNameTT 
=TT  !
_userDataServiceTT" 2
.TT2 3
GetUsernameTT3 >
(TT> ?
)TT? @
??TTA C
$strTTD F
;TTF G
awaitUU 
_auditLogServiceUU &
.UU& ' 
ArchiveAuditLogAsyncUU' ;
(UU; <
userNameUU< D
)UUD E
;UUE F
}WW 
catchXX 
(XX 
SqlExceptionXX 
sqlExXX  %
)XX% &
{YY 
_logServiceZZ 
.ZZ 
LogSqlExceptionZZ +
(ZZ+ ,
sqlExZZ, 1
,ZZ1 2
ControllerContextZZ3 D
.ZZD E
ActionDescriptorZZE U
.ZZU V

ActionNameZZV `
)ZZ` a
;ZZa b
TempData[[ 
[[[ 
$str[[ %
][[% &
=[[' (
$str[[) C
;[[C D
}\\ 
catch]] 
(]] 
	Exception]] 
ex]] 
)]]  
{^^ 
_logService__ 
.__ 
LogGeneralException__ /
(__/ 0
ex__0 2
,__2 3
ControllerContext__4 E
.__E F
ActionDescriptor__F V
.__V W

ActionName__W a
)__a b
;__b c
TempData`` 
[`` 
$str`` %
]``% &
=``' (
$str``) C
;``C D
}aa 
returnbb 
RedirectToActionbb #
(bb# $
nameofbb$ *
(bb* +
Indexbb+ 0
)bb0 1
,bb1 2
$strbb3 =
)bb= >
;bb> ?
}cc 	
[dd 	
HttpPostdd	 
]dd 
publicee 
ActionResultee  
ViewArchivedAuditLogee 0
(ee0 1
)ee1 2
{ff 	
returngg 
RedirectToActiongg #
(gg# $
nameofgg$ *
(gg* +
Indexgg+ 0
)gg0 1
,gg1 2
$strgg3 E
)ggE F
;ggF G
}hh 	
}ii 
}jj š,
ZD:\a\apha-bst\apha-bst\src\Apha.BST\Apha.BST.Web\Controllers\AuditLogArchivedController.cs
	namespace 	
Apha
 
. 
BST 
. 
Web 
. 
Controllers "
{		 
public

 

class

 &
AuditLogArchivedController

 +
:

, -

Controller

. 8
{ 
private 
readonly $
IAuditlogArchivedService 1#
_auditLogArchiveService2 I
;I J
private 
readonly 
IMapper  
_mapper! (
;( )
public &
AuditLogArchivedController )
() *$
IAuditlogArchivedService* B"
auditLogArchiveServiceC Y
,Y Z
IMapper[ b
mapperc i
)i j
{ 	#
_auditLogArchiveService #
=$ %"
auditLogArchiveService& <
??= ?
throw@ E
newF I!
ArgumentNullExceptionJ _
(_ `
nameof` f
(f g"
auditLogArchiveServiceg }
)} ~
)~ 
;	 €
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
int/ 2
pageNo3 9
=: ;
$num< =
,= >
string? E
columnF L
=M N
$strO Q
,Q R
boolS W
	sortOrderX a
=b c
falsed i
,i j
stringk q
storedProcedure	r 
=
‚ ƒ
$str
„ ‡
)
‡ ˆ
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "
$str" 6
)6 7
;7 8
} 
QueryParameters 
queryParameters +
=, -
new. 1
QueryParameters2 A
{ 
Search 
= 
storedProcedure (
,( )
Page 
= 
pageNo 
, 
PageSize   
=   
$num   
,   
SortBy!! 
=!! 
column!! 
,!!  

Descending"" 
="" 
	sortOrder"" &
}$$ 
;$$ 
var%% 
auditLogsDto%% 
=%% 
await%% $#
_auditLogArchiveService%%% <
.%%< =$
GetArchiveAuditLogsAsync%%= U
(%%U V
queryParameters%%V e
,%%e f
storedProcedure%%g v
)%%v w
;%%w x
var&& 
	auditLogs&& 
=&& 
_mapper&& #
.&&# $
Map&&$ '
<&&' (
IEnumerable&&( 3
<&&3 4&
AuditLogsArchivedViewModel&&4 N
>&&N O
>&&O P
(&&P Q
auditLogsDto&&Q ]
.&&] ^
data&&^ b
)&&b c
;&&c d
List)) 
<)) 
string)) 
>))  
storedProcedureNames)) -
=)). /
await))0 5#
_auditLogArchiveService))6 M
.))M N(
GetStoredProcedureNamesAsync))N j
())j k
)))k l
;))l m
var** 
dropDownList** 
=**  
storedProcedureNames** 3
.++ 
Select++ 
(++ 
name++ 
=>++ 
new++  #
SelectListItem++$ 2
{,, 
Value-- 
=-- 
name--  
,--  !
Text.. 
=.. 
name.. 
}// 
)// 
.00 
ToList00 
(00 
)00 
;00 
var33 
model33 
=33 
new33 )
AuditLogArchivedListViewModel33 9
{44 
AuditLogsResults55  
=55! "
	auditLogs55# ,
.55, -
ToList55- 3
(553 4
)554 5
,555 6
StoredProcedures66  
=66! "
dropDownList66# /
,66/ 0
StoredProcedure77 
=77  !
storedProcedure77" 1
,771 2

Pagination88 
=88 
new88  
PaginationModel88! 0
{99 

TotalCount:: 
=::  
auditLogsDto::! -
.::- .

TotalCount::. 8
,::8 9

PageNumber;; 
=;;  
queryParameters;;! 0
.;;0 1
Page;;1 5
,;;5 6
PageSize<< 
=<< 
queryParameters<< .
.<<. /
PageSize<</ 7
,<<7 8

SortColumn== 
===  
queryParameters==! 0
.==0 1
SortBy==1 7
,==7 8
SortDirection>> !
=>>" #
queryParameters>>$ 3
.>>3 4

Descending>>4 >
}?? 
}@@ 
;@@ 
returnBB 
ViewBB 
(BB 
modelBB 
)BB 
;BB 
}CC 	
[DD 	
HttpPostDD	 
]DD 
publicEE 
ActionResultEE 
CurrentAuditLogEE +
(EE+ ,
)EE, -
{FF 	
returnGG 
RedirectToActionGG #
(GG# $
nameofGG$ *
(GG* +
IndexGG+ 0
)GG0 1
,GG1 2
$strGG3 =
)GG= >
;GG> ?
}HH 	
}II 
}JJ 