using System.Collections.Generic;
using Apha.BST.Core.Entities;
using Apha.BST.Core.Interfaces;
using Apha.BST.DataAccess.Data;
using Microsoft.Data.SqlClient;
using Microsoft.EntityFrameworkCore;

namespace Apha.BST.DataAccess.Repositories
{
    public class AccessControlRepository : RepositoryBase<UserRoleInfo>, IAccessControlRepository
    {
        public AccessControlRepository(BstContext context) : base(context) { }
        public async Task<(byte? RoleId, string? Username)?> GetRoleIdAndUsernameByEmailAsync(string email)
        {
            var param = new SqlParameter("@UserID", email);
            var result = await GetQueryableResultFor<UserRoleInfo>("EXEC sp_User_Get @UserID", param)
                .AsNoTracking()
               .ToListAsync();

            if (result.Count > 0)
            {
                var item = result[0];
                if (item == null)
                {
                    return null;
                }
                return (item.UserLevel, item.UserName);
            }
            return null;



        }

    }
}
